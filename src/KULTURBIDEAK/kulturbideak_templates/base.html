<html>
<head>
{% load i18n %}
{# Load the tag library #}
<script charset="utf-8" type="text/javascript" src="{{STATIC_URL}}js/jquery-1.9.1.js"></script>
{% load bootstrap3 %}
<script charset="utf-8" type="text/javascript" src="{{STATIC_URL}}js/raphael-min.js"></script>
{# Load CSS and JavaScript #}
<script charset="utf-8" type="text/javascript" src="{{STATIC_URL}}js/main.js"></script>
<script charset="utf-8" type="text/javascript" src="{{STATIC_URL}}js/kulturbideak.js"></script>
<!-- Social Share Kit CSS -->
<link rel="stylesheet" href="{{STATIC_URL}}css/social-share-kit.css" type="text/css">
<!-- Social Share Kit JS -->
<script type="text/javascript" src="{{STATIC_URL}}js/social-share-kit.js"></script>

{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% load leaflet_tags %}
{% load tags%}

{% leaflet_js %}
{% leaflet_css %}
{% load qr_tags %}




<style type="text/css">
    body{
        font-family: Verdana,Arial,sans-serif;
    }

    .page_head{
        height: 200px;
    }
    .headerra{
    	background-color: #d9edf7;
    }
    .titulu-kolorea{
    	color: #31708f;
    }
   .bilaketaEmaitza{

		/*background-image: url("/home/maddalen/Documents/Aptana Studio 3 Workspace/KULTURBIDEAK/src/KULTURBIDEAK/kulturbideak_app/media/uploads/NoIrudiItem.png");*/
		background-image: url("/uploads/NoIrudiItem.png");
		min-height: 120px;
		background-size: 120px 120px;
	
	}
	.bilaketaEmaitzaPath{
		
		background-image: url("/uploads/NoIrudiBide.png");
		min-height: 120px;
		background-size: 120px 120px;
	}
	 .emaitzaInfo{
		text-align: left;
		color:#337ab7;
    }

	
    #workspace{
        position:fixed;
        width: 80%;
        min-width: 800px;
        left: 10%;
        text-align: center;
        z-index: 100;
    }

    #workspace_boxes{
        overflow: auto;
        display: block;
        height: 0;
        border: 1px solid #808080;
        background: #e7e7e7;
        opacity: 0;
        -webkit-transition: height 1s,opacity 1s ease-in-out;
        transition: height 1s,opacity 1s ease-in-out;
    }

    .open{
        height: 300px!important;
        opacity: 100!important;
    }

    .close{
        overflow: hidden!important;
    }
    
    .ws_box{
        border: 1px solid;
        display: inline-block;
        height: 50px;
        margin: 5px 5px;
        padding: 10px;
        width: 200px;
        vertical-align: top;
        cursor: move;
    }

    .wsb_image{
        float: left;
        max-height: 50px;
        max-width: 40px;
        margin-right: 10px;
        pointer-events: none;
    }

    .wsb_title{
        font-size: 10pt;
        pointer-events: none;
    }

    .wsb_button{
        cursor: pointer;
        display: inline-block;
        visibility: hidden;
        font-size: 8pt;
        font-weight: bold;
        float: right;
    }

    .ws_box:hover .wsb_button{
        visibility: visible;
    }

    .ws_box_over{
        border: 1px dotted #808080;
        background: #d3d3d3;
    }

	#path_boxes_egunekoa{
		width: 98%;
        height: 500px;
        display: block;
        margin-top: 20px;
        background: #e7e7e7;
        resize: both;
        overflow: scroll;
	}
	#path_boxes_overview{
		width: 98%;
        height: 205px;
        display: block;
        margin-top:-29px;
        background: ;
        resize: both;
        overflow: scroll;
	}
    #path_boxes{
        width: 98%;
        height: 500px;
        display: block;
        border: 1px solid #808080;
        margin-top: 20px;
        background: #F3F3F3;
        overflow: auto;
        resize: both;
    }
    
    #path_boxes svg{
        width: 100%;
        height: 100%;
    }

    .pb_box{
        cursor: move;
        fill: transparent;
        stroke: #000000;
        stroke-width:1;
    }
    
    .pb_box_overview{
        cursor: move;
        fill: transparent;
        stroke: #000000;
        stroke-width:1;
        height:50;
    }

    .pb_box_back{
        fill: #ffffff;
    }
    
    .pb_box_back_nabarmendu{
        fill: #FFEBFF;
    }
    .pb_box_back_overview{
        fill: #F3F3F3;
    }

    

    .pb_box_title{
        font-size: 12pt!important;
    }

    .pb_box_image{
    }

    .pb_box_back_moving{
        fill: #808080;
        opacity: 0.5;
    }

    .pb_box_delete_button{
        cursor: pointer;
        font-weight: bold!important;
        font-size: 10pt!important;
    }
   .pb_box_delete_button{
        cursor: pointer;
        fill: #808080!important;
        font-weight: bold!important;
        font-size: 10pt!important;
    }

    .pb_box_delete_button:hover{
        fill: #000000!important;
    }
    
    .orria{
    	display: block;
    	margin: 0 auto;
    	text-align: center;
    }
    .eskuma_div{
    	width: 15%;
    	min-height: 500px;
    	display:inline-block;
		background: white;
		vertical-align: top;
		text-align: left;
		color:#31708f;
    }
    .ezkerra_div{
    	width: 15%;
    	min-height: 500px;
    	display:inline-block;
    	background:white;
		vertical-align: top;
		text-align: left;
		color: #31708f;
    }
    .content_div{
    	width: 65%;
    	min-height: 500px;
    	display:inline-block;
    	background: white;
		vertical-align: top;
		margin: 0 20px;
		text-align: left;
    }
    
    .erabiltzaile-menua{
    	font-size: 9pt;
   		margin-top: 0.5em;font-size: 9pt;
   		text-align: right;
   
    }
   .pathBotoia{
   	text-align: right;
   	position:relative;
   	alignment-adjust: right;
   	
   }
   .footer{
   	bottom: 0;
   	position:fixed;
   	text-align:fixed;
   	background: #F0FFFF; 
   	width: 95%;
   }
  .hizkuntzak_class {
    float: left;
    width: auto;
	}
	.ulhizkuntzak {
    font-size: 13px;
	}
	.ulhizkuntzak li {
	float: left;
	padding: 0px 6px 0px 6px;
	border-right: 2px solid #FFFFFF;
	color:#31708F;
	
	}
	.ulhizkuntzak li:last-child {
	border-right: 0px;
	}
	#header-content {
    margin: 0 auto;
    max-width: 1024px;
    width: 100%;
	}
	.ulNon {
	margin: 3px 0px 0px 0px;
	float: left;
	}
	.ulNon li {
	float: left;
	padding: 0px 6px 0px 6px;
	border-right: 1px solid #928a83;
	font-size: 13px;
	}
	.ulNon li:last-child {
	border-right: 0px;
	}
	.ulNon li a {
	color: #928a83;
	}
	.ulNon li.active a {
	font-family: "MetaBold", Helvetica, Arial, Verdana, sans-serif;
	color: #60554b;
	}
	.ibilbide-panela{
		width: 98%;
	}
	.info{
		color: #337ab7;
	}	
	.dropdown:hover .dropdown-menu {
    display: block; right: 20px; top: 0px;
    margin-top: 0;
    width:300px;
    position:relative;
   	alignment-adjust: right;
   	float: right;
   	z-index: 1000000000;
   	left:inherit;
    
 	}
	
	.text-center {
    text-align: center;
    }
	.laguntza {
		color:  #9e8012;
	}
	
	.thumb-128 {
    height: 128px;
    line-height: 128px;
    padding: 4px;
    width: 128px;  
    max-height: 100%;
    max-width: 100%;

	}
	.eskuma{
	float:right;
	}
	.ezkerra{
	float:left;
	}
	.aurkezpena{}
	.path_sarrera{
		overflow:hidden;
	}
/* HEADERRAREN ESTILOA*/

 .navbar-default-berria .navbar-brand-berria {
    color: #31708f!important;
  }
 .navbar-brand-berria {
    float: left;
    font-size: 35px!important;
    height: 70px!important;
    line-height: 0;
    padding: 20px!important;
 }

	.navbar-default .navbar-nav > li > a {
    color: #31708f!important;
	}
	.navbar-nav > li > a {
    padding-bottom: 15px!important;
    padding-top: 35px!important;
	}
	.bilatzailea-kutxa{
	 padding: 20px;
   	 
	}
	.kolorea{
		background-color: #31708f!important;
    	border-color: #31708f!important;
    	color: #fff;
    
    }
    .table-barrukoa{
    	font-size: 15px!important;
    }
    
    tr.spaceUnder > th
	{
 	 padding-bottom: 0.1em;
	}
	
	a.morelink {
    text-decoration:none;
    outline: none;
	}
	.morecontent span {
    display: none;
	}
	.comment {
    /*width: 400px;*/
    margin: 10px;
	}
	.aRight {
		float: right;
	}
</style>

<script type="text/javascript">
  
  //MAPA FUNTZIOAK
  
    var global_map;
    var layer_array = Array();
    var LeafIcon = L.Icon.extend({});    
    var markers = [];
   
    {% if non == 'itema_gehitu'  %}
        function load_map(map, options)
        {
        	
            global_map=map;
           
             // zentratu mapa erabiltzaileak 
             if(markers.length>0)
             {
                 map.panTo(new L.LatLng( markers[0].getLatLng().lat, markers[0].getLatLng().lng));
                 //document.getElementById("latitude").value = markers[0].getLatLng().lat;
                 //document.getElementById("longitude").value = markers[0].getLatLng().lng;
                 //alert(document.getElementById("longitude").value);
             }

            // maparen click eventoa 
            //map.on('click', function(e) {if(markers.length >0){map.removeLayer(markers[0]);markers=[];}; var marker = L.marker(e.latlng, { title: "Resource Location",alt: "Resource Location",riseOnHover: true,draggable: true}).on("click",function(e) {map.removeLayer(this);layer_array=jQuery.grep(layer_array, function(value) {return $(value).not([e.latlng.lat,e.latlng.lng]).length === 0 && $([e.latlng.lat,e.latlng.lng]).not(value).length === 0});}).addTo(map);layer_array.push([e.latlng.lat,e.latlng.lng]);markers.push(marker);});
			map.on('click', function(e) {if(markers.length >0){map.removeLayer(markers[0]);markers=[];}; var marker = L.marker(e.latlng, { title: "Resource Location",alt: "Resource Location",riseOnHover: true,draggable: true}).on("click",function(e) {map.removeLayer(this);layer_array=jQuery.grep(layer_array, function(value) {return $(value).not([e.latlng.lat,e.latlng.lng]).length === 0 && $([e.latlng.lat,e.latlng.lng]).not(value).length === 0});}).addTo(map);layer_array.push([e.latlng.lat,e.latlng.lng]);markers.push(marker);document.getElementById("latitude").value = e.latlng.lat;document.getElementById("longitude").value = e.latlng.lng;});
			
       		 
       	}
    {% else %}
        function load_map(map, options)
        {        	
           		map.panTo(new L.LatLng({{ geoloc_latitude|correct_float_format }}, {{ geoloc_longitude|correct_float_format }}));
           		L.marker([{{ geoloc_latitude|correct_float_format }}, {{ geoloc_longitude|correct_float_format }}]).addTo(map).openPopup();                
  		
        }
    {% endif %}
</script>

<script>
	$(function () {
        // Remove Search if user Resets Form or hits Escape!
		$('body, .navbar-collapse form[role="search"] button[type="reset"]').on('click keyup', function(event) {
			console.log(event.currentTarget);
			if (event.which == 27 && $('.navbar-collapse form[role="search"]').hasClass('active') ||
				$(event.currentTarget).attr('type') == 'reset') {
				closeSearch();
			}
		});

		function closeSearch() {
            var $form = $('.navbar-collapse form[role="search"].active')
    		$form.find('input').val('');
			$form.removeClass('active');
		}

		// Show Search if form is not active // event.preventDefault() is important, this prevents the form from submitting
		$(document).on('click', '.navbar-collapse form[role="search"]:not(.active) button[type="submit"]', function(event) {
			event.preventDefault();
			var $form = $(this).closest('form'),
				$input = $form.find('input');
			$form.addClass('active');
			$input.focus();

		});
		// ONLY FOR DEMO // Please use $('form').submit(function(event)) to track from submission
		// if your form is ajax remember to call `closeSearch()` to close the search container
		$(document).on('click', '.navbar-collapse form[role="search"].active button[type="submit"]', function(event) {
			event.preventDefault();
			var $form = $(this).closest('form'),
				$input = $form.find('input');
			$('#showSearchTerm').text($input.val());
            closeSearch()
		});
    });
	
	
</script>

<script>


//READ MORE FUNTZIOAK

$(document).ready(function() {
    var showChar = 200;
    var ellipsestext = "...";
    var moretext = "more";
    var lesstext = "less";
    $('.more').each(function() {
        var content = $(this).html();
 
        if(content.length > showChar) {
 
            var c = content.substr(0, showChar);
            var h = content.substr(showChar-1, content.length - showChar);
 
            var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';
 
            $(this).html(html);
        }
 
    });
 
    $(".morelink").click(function(){
        if($(this).hasClass("less")) {
            $(this).removeClass("less");
            $(this).html(moretext);
        } else {
            $(this).addClass("less");
            $(this).html(lesstext);
        }
        $(this).parent().prev().toggle();
        $(this).prev().toggle();
        return false;
    });
});

</script>

<script>




var paper = null;
var el_counter=0;
var svgns = "http://www.w3.org/2000/svg";
var pb_box_w = 160;
var pb_box_h = 120;
var pb_box_space = 20;//
var paths_starts = [];
var connections = [];


function initialize(){
	//raphael martxan jartzeko
	set_pb();
	//kargatu workspaceko elementuak
	load_ws();
	//kargatu erabiltzailearen ibilbideak
	//load_paths_list(user_id);
	//Kargatu Ibilbide bozkatuenak
	load_most_voted_paths();
}

function hizkuntza_url_egokitu(linka){
	
    //Hizkuntza aukeraketa egiten duen formularioaren url helbidea egokitzen du
    var form=document.getElementById("hizkuntza_aukeraketa_id");
    var hizkuntza=linka.text.toLowerCase();
    form.name="setLang"+hizkuntza;
    document.getElementsByName("language")[0].value=hizkuntza;
    document.getElementsByName("setLang"+hizkuntza)[0].submit();
    return false;

}

//pantailaren albo batean erabiltzailearen path-ak kargatzeko
function load_paths_list(user_id){
	var paths_list_container = document.getElementById("nire_ibilbideak");
	if (paths_list_container){
		//ajax deia, kargatu kontainerrean zerrenda
		load_paths_list_request(paths_list_container, user_id);
	}
}


function load_paths_list_request(paths_list_container,user_id)
{
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
        xmlHttp.open("POST","../ajax_lortu_paths_list",true);
        xmlHttp.onreadystatechange = function (){
            load_paths_list_answer(xmlHttp,paths_list_container);                                                                   // Erantzuna jasotzean exekutatuko den deia
        };
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("user_id=" + user_id  + "&csrfmiddlewaretoken=" + csrftoken);                       // Eskaera bidali
    }
}

function load_paths_list_answer(xmlHttp,paths_list_container)
{
	
	if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
			var xml_answer = xmlHttp.responseXML;
			var xml_Document = xml_answer.documentElement;
			var paths = xml_Document.getElementsByTagName("path");
			
			for (var i=0;i<paths.length;i++){
				
				id = paths[i].getElementsByTagName("id")[0].firstChild.data;
				titulua="";
				if (paths[i].getElementsByTagName("titulua")[0].firstChild){
					titulua = paths[i].getElementsByTagName("titulua")[0].firstChild.data;
				}
				deskribapena="";
				if (paths[i].getElementsByTagName("deskribapena")[0].firstChild){
					deskribapena = paths[i].getElementsByTagName("deskribapena")[0].firstChild.data;
				}
				irudia = "";
				if (paths[i].getElementsByTagName("irudia")[0].firstChild){
					irudia = paths[i].getElementsByTagName("irudia")[0].firstChild.data;
				}
				add_path_to_list(id,titulua,deskribapena,irudia);
			}                                 
        }
    }
	
}

function add_path_to_list(id,titulua,deskribapena,irudia){
	
	var ibilbideak_div = document.getElementById("nire_ibilbideak");
    
    var p = document.createElement('p');
    
    var a = document.createElement('a');
	var linkText = document.createTextNode(titulua);
	a.appendChild(linkText);
	a.title = titulua;
	a.href = "editatu_ibilbidea?id="+id;
	ibilbideak_div.appendChild(p);
	ibilbideak_div.appendChild(a);
    
    
}


//pantailaren albo batean Ibilbide bozkatuenak kargatzeko
function load_most_voted_paths(){
	var paths_list_container = document.getElementById("ibilbide_bozkatuenak");
	if (paths_list_container){
		//ajax deia, kargatu kontainerrean zerrenda
		load_most_voted_paths_request(paths_list_container);
	}
}


function load_most_voted_paths_request(paths_list_container)
{
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
        xmlHttp.open("POST","../ajax_lortu_most_voted_paths",true);
        xmlHttp.onreadystatechange = function (){
            load_most_voted_paths_answer(xmlHttp,paths_list_container);                                                                   // Erantzuna jasotzean exekutatuko den deia
        };
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("csrfmiddlewaretoken=" + csrftoken);     // Eskaera bidali
    }
}

function load_most_voted_paths_answer(xmlHttp,paths_list_container)
{
	//alert("load_most_voted_paths_answer");	
	if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
			var xml_answer = xmlHttp.responseXML;
			var xml_Document = xml_answer.documentElement;
			var paths = xml_Document.getElementsByTagName("path");
			
			
			for (var i=0;i<paths.length;i++){
				
				id = paths[i].getElementsByTagName("id")[0].firstChild.data;
				
				titulua="";
				
				if (paths[i].getElementsByTagName("titulua")[0].firstChild){
					titulua = paths[i].getElementsByTagName("titulua")[0].firstChild.data;
														
				}
				/*
				deskribapena="";
				if (paths[i].getElementsByTagName("deskribapena")[0].firstChild){
					deskribapena = paths[i].getElementsByTagName("deskribapena")[0].firstChild.data;
				}
				irudia = "";
				if (paths[i].getElementsByTagName("irudia")[0].firstChild){
					irudia = paths[i].getElementsByTagName("irudia")[0].firstChild.data;
				}
				*/
				
				add_most_voted_path_to_list(id,titulua);
			}                                 
        }
    }
	
}

function add_most_voted_path_to_list(id,titulua){
	
	
	
	var ibilbideak_div = document.getElementById("ibilbide_bozkatuenak");
    
    var p = document.createElement('p');
    
    var a = document.createElement('a');
   
	var linkText = document.createTextNode(titulua);
	a.appendChild(linkText);
	
	a.title = titulua;
	a.href = "nabigazioa_hasi?path_id="+id;
	ibilbideak_div.appendChild(p);
	ibilbideak_div.appendChild(a);
    
    
}

function load_ws()
{
	
	load_ws_request();	
}

function load_ws_request(){
	
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
        xmlHttp.open("POST","../ajax_load_ws",true);
        xmlHttp.onreadystatechange = function (){
            load_ws_answer(xmlHttp);                                                                   // Erantzuna jasotzean exekutatuko den deia
        };
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        //xmlHttp.send("user_id=" + user_id +"&ws_id="+ ws_id + "&csrfmiddlewaretoken=" + csrftoken);
        xmlHttp.send("csrfmiddlewaretoken=" + csrftoken);                       // Eskaera bidali
    }
}

function load_ws_answer(xmlHttp){
	  if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
			var xml_answer = xmlHttp.responseXML;
			var xml_Document = xml_answer.documentElement;
			var items = xml_Document.getElementsByTagName("item");
			for (var i=0;i<items.length;i++){
				id = items[i].getElementsByTagName("id")[0].firstChild.data;
				titulua = items[i].getElementsByTagName("titulua")[0].firstChild.data;
				irudia = items[i].getElementsByTagName("irudia")[0].firstChild.data;
				//irudia hutsa baldin bada, defektuzkoa pasa
				if (irudia =="None")
				{
					irudia="/home/maddalen/Documents/Aptana Studio 3 Workspace/KULTURBIDEAK/src/KULTURBIDEAK/kulturbideak_app/media/uploads/NoIrudiItem.png";
				}
				add_workspace_box(id,titulua,irudia);
			}                                 
        }
    }
	
}

function allowDrop(ev) {
    ev.preventDefault();
}

//CSRF tokena kontrolatzeko funtzioak
// using jQuery :::csrftoken-a lortzeko
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}




function remove_me(element,item_id){
	//AJAX-HASI	
	start_loader("loader");                          
	create_remove_me_request(element,item_id);                                       	                                                           
	stop_loader("loader");                                                  
	
    //element.parentNode.removeChild(element);
}

//create workspace_box request
function create_remove_me_request(element,item_id)
{
	//var csrfmiddlewaretoken = document.getElementsByName('csrfmiddlewaretoken')[0].value;
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
		
        xmlHttp.open("POST","../ajax_workspace_item_borratu",true);
        xmlHttp.onreadystatechange = function (){
            create_remove_me_answer(xmlHttp,element);                                                                   
        };
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("item_id=" + item_id  + "&csrfmiddlewaretoken=" + csrftoken);                     
    }
	
	
}

//create remove_me answer
function create_remove_me_answer(xmlHttp,element){
    if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
    		var item_id = server_answer(xmlHttp);
            if (item_id){ 
            	element.parentNode.removeChild(element);           	
			}
			else{                                                                                               // Jaso beharreko emaitza lortu ez bada, errorea
				//show_message("default_error"); //AURRERAGO DIALOG BOX BAT adibidez
				alert ("default error");
			}
			stop_loader("loader");                                                                              // Emaitza ona edo txarra jaso bada, loaderra paratu
        }
    }
}

//workspace funtzioak
function toggle_workspace(){
	//Datu-basetik kargatu item-ak
	var ws = document.getElementById("workspace_boxes");
    if (ws.getAttribute("class") == "open"){
        ws.setAttribute("class","close");
    }
    else{
        ws.setAttribute("class","open");
    }
}

function create_workspace_box(index,user_id){
   	el_counter++;
    var item_id = document.getElementById("item_id_"+index).value;
    var titulua = document.getElementById("titulua_"+index).value;	
    var irudia = document.getElementById("irudia_"+index).value;
   	
    //Ondoren user id-aren arabera WS-id-a lortu
   	
    //var fk_workspace_id=user_id;  //EZ DAGO ONDO
    var uri="uri_"+item_id;
    var dc_source="Euskomedia";
    var dc_title=titulua;
    var dc_description="description";
    var type="argazkia";
    var paths_thumbnail=irudia;
   	//  workspace_item taula:item_id, item_uri, ws_id, item_dc_source, item_dc_title, item_dc_descriptioon, type, thumnail
  	
  	//AJAX
  	start_loader("loader");                             
	if (item_id.value != ""){		                                       
		create_workspace_box_request(item_id,uri,dc_source,dc_title,dc_description,type,paths_thumbnail);                                       //request!
	}
	else{                                                                                                       // baldintzak bete ez badira
		show_message("empty_workspace_box_error");                                                                  // (aukeran) errorea 
	stop_loader("loader");                                                                                      // loaderra gelditu
	}
   
	
    //add_workspace_box(item_id,titulua,irudia);
}



//create workspace_box request
function create_workspace_box_request(item_id,uri,dc_source,dc_title,dc_description,type,paths_thumbnail)
{
//var csrfmiddlewaretoken = document.getElementsByName('csrfmiddlewaretoken')[0].value;
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
		
        xmlHttp.open("POST","../ajax_workspace_item_gehitu",true);
        xmlHttp.onreadystatechange = function (){
            create_workspace_box_answer(xmlHttp,item_id,dc_title,paths_thumbnail);                                                                   
        };
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("item_id="+item_id+ "&uri=" + uri + "&dc_source=" + dc_source + "&dc_title=" + dc_title + "&dc_description=" + dc_description + "&type=" + type + "&paths_thumbnail=" + paths_thumbnail + "&csrfmiddlewaretoken=" + csrftoken);                     
    }
	
	
}
//create workspace box answer
function create_workspace_box_answer(xmlHttp,item_id,titulua,irudia){
    
    if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
    		var item_id_server = server_answer(xmlHttp);
    		
            if (item_id_server){ 
            	
            	//Datu-basean sartu den Id-a nahi dut
            	add_workspace_box(item_id,titulua,irudia);
			}
			else{                                                                                               // Jaso beharreko emaitza lortu ez bada, errorea
				//show_message("default_error"); //AURRERAGO DIALOG BOX BAT adibidez
				alert ("default error");
			}
			stop_loader("loader");                                                                              // Emaitza ona edo txarra jaso bada, loaderra paratu
        }
    }
}

function add_workspace_box(box_id,text_value,image_value){
	
	
	var ws = document.getElementById("workspace_boxes");
    
    var ws_box = document.createElement("div");
    ws_box.setAttribute("id","ws_box_" + box_id);
    //ws_box.setAttribute("id", box_id); //aldaketa
    ws_box.setAttribute("class","ws_box");
    ws_box.setAttribute("draggable","true");
    ws_box.addEventListener('dragstart',drag);
    ws_box.addEventListener('dragenter',wsb_handleDragEnter);
    ws_box.addEventListener('dragleave',wsb_handleDragLeave);

    var wsb_button = document.createElement("span");
    wsb_button.setAttribute("class","wsb_button");
    wsb_button.setAttribute("onclick","remove_me(this.parentNode,"+box_id+");");
    wsb_button.appendChild(document.createTextNode("Ezabatu"));
    ws_box.appendChild(wsb_button);

    var wsb_image = document.createElement("img");
    wsb_image.setAttribute("class","wsb_image");
    wsb_image.setAttribute("src",image_value);
    ws_box.appendChild(wsb_image);

    var wsb_title = document.createElement("span");
    wsb_title.setAttribute("class","wsb_title");
    wsb_title.appendChild(document.createTextNode(text_value));
    ws_box.appendChild(wsb_title);

    ws.appendChild(ws_box);
}


function ws_drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("id");
    var source = document.getElementById(data);
    if (source){
        if (ev.target.id == "workspace_boxes"){
            ev.target.appendChild(source);
        }
        else if (ev.target.classList.contains("ws_box")){
            ev.target.classList.remove('ws_box_over');
            ev.target.parentNode.insertBefore(source,ev.target.nextElementSibling);
        }
    }
}

function drag(ev) {
    ev.dataTransfer.setData("id", ev.target.id);
}

function wsb_handleDragEnter(ev) {
    ev.preventDefault();
    if (ev.target.classList){
        ev.target.classList.add('ws_box_over');
    }
}

function wsb_handleDragLeave(ev) {
    if (ev.target.classList){
        ev.target.classList.remove('ws_box_over');
    }
}

//path box funtzioak




/*
Ajax bidez irudi bat igotzeko adibidea da beheko jQuery-a. sortu_ibilbidea.html-etik deitzen da
 */
/*
$(document).ready(function(){
$('#form').submit(function(e) {

   var form = $(this);        
   var formdata = false;
   if(window.FormData){
     formdata = new FormData(form[0]);
                   
     }

   var formAction = form.attr('action');

                $.ajax({
                    type        : 'POST',
                    url         : '../ajax_path_irudia_gorde_proba',
                    cache       : false,
                    data        : formdata ? formdata : form.serialize(),
                    contentType : false,
                    processData : false,

                    success: function(response) {
                        if(response != 'error') {
                            //$('#messages').addClass('alert alert-success').text(response);
                            // OP requested to close the modal
                           
                             $('#myModal').modal('hide');
                        } else {
                            $('#messages').addClass('alert alert-danger').text(response);
                        }
                    }
                });
                e.preventDefault();
            });
   
});
*/

$(document).ready(function(){
$('#form2').submit(function(e) {

   var form = $(this);      
   var formdata = false;
   if(window.FormData){
     formdata = new FormData(form[0]);
                   
     }

   var formAction = form.attr('action');

                $.ajax({
                    type        : 'POST',
                    url         : '../ajax_path_irudia_gorde',
                    cache       : false,
                    data        : formdata ? formdata : form.serialize(),
                    contentType : false,
                    processData : false,

                    success: function(response) {
                        if(response != 'error') {
                            //$('#messages').addClass('alert alert-success').text(response);
                            // OP requested to close the modal
                            
                            //GAINONTZEKO METADATUAK GORDE : TITULUA, GAIA, DESK
                           create_path_on_db();
                           
                           //$('#myModal').modal('hide');
                        } else {
                            $('#messages').addClass('alert alert-danger').text(response);
                        }
                    }
                });
                e.preventDefault();
            });
   
});

//Ibilbidea eguneratzean irudia gordetzeko
$(document).ready(function(){
$('#formEguneratu').submit(function(e) {

   var path_id = document.getElementById("path_id").value;
   var form = $(this);      
   var formdata = false;
   if(window.FormData){
     formdata = new FormData(form[0]);
                   
     }

   var formAction = form.attr('action');

                $.ajax({
                    type        : 'POST',
                    url         : '../ajax_path_irudia_eguneratu',
                    cache       : false,
                    data        : formdata ? formdata : form.serialize(),
                    contentType : false,
                    processData : false,

                    success: function(response) {
                        if(response != 'error') {
                            //$('#messages').addClass('alert alert-success').text(response);
                            // OP requested to close the modal
                            
                            //GAINONTZEKO METADATUAK GORDE : TITULUA, GAIA, DESK,HIZK
                           update_path_on_db(path_id);
                           
                           //$('#myModal').modal('hide');
                        } else {
                            $('#messages').addClass('alert alert-danger').text(response);
                        }
                    }
                });
                e.preventDefault();
            });
   
});

/*
 * 
 * IBILBIDEA SORTZEKO FUNTZIOAK
 * 
 */


function create_path_on_db()
{
		
	var dc_title = document.getElementById("path_titulua").value;
	var dc_description = document.getElementById("path_desk").value;
	var dc_subject = document.getElementById("path_gaia").value;
	var paths_thumbnail = document.getElementById("file2");
	var paths_thumbnail_name=paths_thumbnail.value;
	var hizkuntza =document.getElementById("hizkuntza").value;
	
	//alert(paths_thumbnail_name);
	
	start_loader("loader");  
	
	uri="urii";
   
    //paths_thumbnail = "";   //MEDIA_URL+edm_object           , parametro bezala pasa MEDIA_URL                                                                             // beharrezko baldintzak jaso
	
	if (paths_starts.length > 0){
		                                            
		create_path_on_db_request(uri,dc_title,dc_subject,dc_description,paths_thumbnail_name,hizkuntza);                                  
	}
	else{                                                                                                       // baldintzak bete ez badira
		alert("empty_path_error");                                                                  // (aukeran) errorea 
	}
	stop_loader("loader");                                                                                      // loaderra gelditu

}

function create_path_on_db_request(uri,dc_title,dc_subject,dc_description,paths_thumbnail_name,hizkuntza)
{
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
		
        xmlHttp.open("POST","../ajax_path_berria_gorde",true);
        xmlHttp.onreadystatechange = function (){
            create_path_on_db_answer(xmlHttp);                                                                   
        };
        
       
     
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("uri="+uri+"&dc_title="+dc_title+"&dc_subject="+dc_subject+"&dc_description="+dc_description+"&paths_thumbnail="+paths_thumbnail_name+"&hizkuntza="+hizkuntza+"&csrfmiddlewaretoken=" + csrftoken);                     
    }
	
}


function create_path_on_db_answer(xmlHttp)
{
	if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
    		var path_id = server_answer(xmlHttp);
            if (path_id){ 
            
            	//ORAIN NODE TAULA EGUNERATU
            	create_path_nodes(path_id);
            	
            	//add_workspace_box(item_id,titulua,irudia);
			}
			else{                                                                                               // Jaso beharreko emaitza lortu ez bada, errorea
				//show_message("default_error"); //AURRERAGO DIALOG BOX BAT adibidez
				alert ("default error");
			}
			stop_loader("loader");                                                                              // Emaitza ona edo txarra jaso bada, loaderra paratu
        }
    }
	
}

function create_path_nodes(path_id)
{
		
	//NODE BAKOITZEKO
	start_loader("loader");
	//Erroak
	var nodes = paths_starts;
	for(var i = 0; i < nodes.length; i++) {
		var erroa=paper.getById(nodes[i]);

		var item_id= erroa.id;
		var uri="uri_"+erroa.id;
		var dc_source="Euskomedia";
		//var dc_description="desc";
		var type ="argazkia";
		var paths_thumbnail=erroa.data("image_value");
		
		//MAD
		var item_narrazioa=erroa.data("item_narrazioa");
		var dc_description=item_narrazioa;
		
		var paths_prev =(erroa.data("parent_id"))?erroa.data("parent_id"):"";
		
		var dc_title =erroa.data("text_value");
		var semeak =erroa.data("children");
		var paths_next=semeak.join();
		var paths_start =(erroa.data("parent_id"))?0:1;
			
		create_path_nodes_request(path_id,item_id,uri,dc_source,dc_title,dc_description,type,paths_thumbnail,paths_prev,paths_next,paths_start);
		nodes = nodes.concat(semeak);
	}

	stop_loader("loader");           
	
	

	
}
function create_path_nodes_request(path_id,item_id,uri,dc_source,dc_title,dc_description,type,paths_thumbnail,paths_prev,paths_next,paths_start)
{
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
		
        xmlHttp.open("POST","../ajax_path_node_gorde",true);
        xmlHttp.onreadystatechange = function (){
            create_path_node_answer(xmlHttp);                                                                   
        };
      
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("path_id="+path_id+"&item_id="+item_id+"&uri="+uri+"&dc_source="+dc_source+"&dc_title="+dc_title+"&dc_description="+dc_description+"&type="+type+"&paths_thumbnail="+paths_thumbnail+"&paths_prev="+paths_prev+"&paths_next="+paths_next+"&paths_start="+paths_start+"&csrfmiddlewaretoken=" + csrftoken); 																																			
    }
}

function create_path_node_answer(xmlHttp)
{
	
	if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
    		var path_node_id = server_answer(xmlHttp);
            if (path_node_id){
            	//alert ("gorde da nodea:"+path_node_id);
            	//console.log("gorde da nodea:"+path_node_id);
            	
            	
            	//leiho modaleko botoia desgaitu
            	//document.getElementById("botSortu").setAttribute("disabled","disabled");
            	//leiho modaletik irten
               	 $('#modalwindow').modal('hide'); //JQUERY      	
            	//pantaila nagusiko botoia desgaitu
            	document.getElementById("create_path_button").setAttribute("disabled","disabled");
            	
			}
			else{                                                                                               // Jaso beharreko emaitza lortu ez bada, errorea
				//show_message("default_error"); //AURRERAGO DIALOG BOX BAT adibidez
				alert ("default error");
			}
			stop_loader("loader");                                                                              // Emaitza ona edo txarra jaso bada, loaderra paratu
        }
    }
}


/*
 * IBILBIDEA EGUNERATZEKO FUNTZIOAK
 * 
 */

function update_path_on_db(path_id)
{
	
	var dc_title = document.getElementById("path_titulua").value;
	var dc_description = document.getElementById("path_desk").value;
	var dc_subject = document.getElementById("path_gaia").value;
	var paths_thumbnail = document.getElementById("file2");
	var paths_thumbnail_name=paths_thumbnail.value;	
	var hizkuntza =document.getElementById("hizkuntza").value;
	
	
	
	start_loader("loader");  	                                                                                   	
	if (paths_starts.length > 0){		                                            
		update_path_on_db_request(path_id,dc_title,dc_subject,dc_description,paths_thumbnail_name,hizkuntza);                                  
	}
	else{                                                                                                      
		alert("empty_path_error");                                                                
	}
	stop_loader("loader");   
}

function update_path_on_db_request(path_id,dc_title,dc_subject,dc_description,paths_thumbnail_name,hizkuntza)
{
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
		
        xmlHttp.open("POST","../ajax_path_eguneratu",true);
        xmlHttp.onreadystatechange = function (){
            update_path_on_db_answer(xmlHttp,path_id);                                                                   
        };
      
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send("path_id="+path_id+"&dc_title="+dc_title+"&dc_subject="+dc_subject+"&dc_description="+dc_description+"&paths_thumbnail="+paths_thumbnail_name+"&hizkuntza="+hizkuntza+"&csrfmiddlewaretoken=" + csrftoken);                     
    }
	
}


function update_path_on_db_answer(xmlHttp,path_id)
{
	if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
    		var path_id = server_answer(xmlHttp);
            if (path_id){ 
            
            	//ORAIN NODE TAULA EGUNERATU
            	update_path_nodes(path_id);
            	
            	
			}
			else{                                                                                               // Jaso beharreko emaitza lortu ez bada, errorea
				//show_message("default_error"); //AURRERAGO DIALOG BOX BAT adibidez
				alert ("default error");
			}
			stop_loader("loader");                                                                              // Emaitza ona edo txarra jaso bada, loaderra paratu
        }
    }
	
}


/* Ibilbidea eguneratzean, ibilbideko nodo bakoitzaren eguneraketa burutzen da ajax bidez jarraian
 dauden funtzioekin */

function update_path_nodes(path_id)
{
		
	//NODE BAKOITZEKO
	start_loader("loader");
	//Erroak
	var nodes = paths_starts;
	for(var i = 0; i < nodes.length; i++) {
		var erroa=paper.getById(nodes[i]);

		var item_id= erroa.id;
		var uri="uri_"+erroa.id;
		var dc_source="Euskomedia";
		//var dc_description="desc";
		var type ="argazkia";
		var paths_thumbnail=erroa.data("image_value");
		
		//MAD
		var item_narrazioa=erroa.data("item_narrazioa");
		var dc_description=item_narrazioa;
		
		var paths_prev =(erroa.data("parent_id"))?erroa.data("parent_id"):"";
		
		var dc_title =erroa.data("text_value");
		var semeak =erroa.data("children");
		var paths_next=semeak.join();
		var paths_start =(erroa.data("parent_id"))?0:1;
			
		update_path_nodes_request(path_id,item_id,uri,dc_source,dc_title,dc_description,type,paths_thumbnail,paths_prev,paths_next,paths_start);
		nodes = nodes.concat(semeak);
	}

	stop_loader("loader");           
	
	

	
}
function update_path_nodes_request(path_id,item_id,uri,dc_source,dc_title,dc_description,type,paths_thumbnail,paths_prev,paths_next,paths_start)
{
	
	var csrftoken = getCookie('csrftoken');
	var xmlHttp = createXmlHttpRequestObject();
	
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){ 
		
		$.ajaxSetup({
   			beforeSend: function(xhr, settings) {
       		if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           		xhr.setRequestHeader("X-CSRFToken", csrftoken);
       		}
   		 	}
		});
		
        xmlHttp.open("POST","../ajax_path_node_eguneratu",true);
        xmlHttp.onreadystatechange = function (){
            update_path_node_answer(xmlHttp);                                                                   
        };
      
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
       // xmlHttp.send("path_id="+path_id+"&item_id="+item_id+"&uri="+uri+"&dc_source="+dc_source+"&dc_title="+dc_title+"&dc_description="+dc_description+"&type="+type+"&paths_thumbnail="+paths_thumbnail+"&paths_prev="+paths_prev+"&paths_next="+paths_next+"&paths_start="+paths_start+"&csrfmiddlewaretoken=" + csrftoken); 																																			
        xmlHttp.send("path_id="+path_id+"&item_id="+item_id.replace("pb_","")+"&uri="+uri+"&dc_source="+dc_source+"&dc_title="+dc_title+"&dc_description="+dc_description+"&type="+type+"&paths_thumbnail="+paths_thumbnail+"&paths_prev="+paths_prev.replace("pb_","")+"&paths_next="+paths_next.replace("pb_","")+"&paths_start="+paths_start+"&csrfmiddlewaretoken=" + csrftoken); 																																			
    }
}

function update_path_node_answer(xmlHttp)
{
	
	if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
    		var path_node_id = server_answer(xmlHttp);
            if (path_node_id){
            	//alert ("gorde da nodea:"+path_node_id);
            	//console.log("gorde da nodea:"+path_node_id);
            	
            	
            	//leiho modaleko botoia desgaitu
            	//document.getElementById("botSortu").setAttribute("disabled","disabled");
            	//leiho modaletik irten
               	 $('#modalwindow').modal('hide'); //JQUERY      	
            	//pantaila nagusiko botoia desgaitu
            	document.getElementById("update_path_button").setAttribute("disabled","disabled");
            	
			}
			else{                                                                                               // Jaso beharreko emaitza lortu ez bada, errorea
				//show_message("default_error"); //AURRERAGO DIALOG BOX BAT adibidez
				alert ("default error");
			}
			stop_loader("loader");                                                                              // Emaitza ona edo txarra jaso bada, loaderra paratu
        }
    }
}



//ibilbideak sortzeko arbela
function set_pb(){
    if (document.getElementById("path_boxes") && (document.getElementById("path_boxes").children.length == 0)){
        paper = Raphael(document.getElementById("path_boxes"), "100%", "100%");
    }
}
//Maddalen: hasierako pantailan eguneko ibilbidea marrazteko
function set_pb_egunekoa(){
    if (document.getElementById("path_boxes_egunekoa") && (document.getElementById("path_boxes_egunekoa").children.length == 0)){
        paper = Raphael(document.getElementById("path_boxes_egunekoa"), "100%", "100%");
    }
}
//Maddalen: Ibilbidearen eskema orokorra eta momentuko itema nabamenduta marrazteko
function set_pb_overview(){
    if (document.getElementById("path_boxes_overview") && (document.getElementById("path_boxes_overview").children.length == 0)){
        paper = Raphael(document.getElementById("path_boxes_overview"), "100%", "25%");
    }
}

function get_x(pos){
    return (pb_box_space + pos*(pb_box_space + pb_box_w));
}

function get_y(pos){
    return (pb_box_space + pos*(pb_box_space + pb_box_h));
}

function get_x_pos(x){
    return parseInt((x - pb_box_space)/(pb_box_space + pb_box_w));
}

function get_y_pos(y){
    return parseInt((y - pb_box_space)/(pb_box_space + pb_box_h));
}

function pb_drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("id");
    var source = document.getElementById(data);
    if ((ev.target.parentNode.id == "path_boxes") && source && source.getAttribute("class") == "ws_box") {
        var image_value = source.children[1].src;
        var text_value = source.children[2].firstChild.data;
        pb_new_element(data,text_value,image_value);
        //alert(data);//ws_box_1
        var item_id=data.replace("ws_box_", ""); 
        remove_me(source,item_id);
    }
}
//Maddalen
/*
function pb_drop_egunekoa(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("id");
    var source = document.getElementById(data);
    if ((ev.target.parentNode.id == "path_boxes_egunekoa") && source && source.getAttribute("class") == "ws_box") {
        var image_value = source.children[1].src;
        var text_value = source.children[2].firstChild.data;
        pb_new_element_egunekoa(data,text_value,image_value);
        //alert(data);//ws_box_1
        var item_id=data.replace("ws_box_", ""); 
        remove_me(source,item_id);
    }
}
*/
function pb_window_resize(){
    var svg = paper.canvas;
    var svgBBox = paper.canvas.getBBox();
    var container = svg.parentNode;
    if (svgBBox.height < container.offsetHeight){
        svg.style.height = (container.offsetHeight + pb_box_space) + "px";
    }
    else{
        svg.style.height = (svgBBox.height + (pb_box_space + pb_box_h)) + "px";
    }
    if (svgBBox.width < container.offsetWidth){
        svg.style.width = (container.offsetWidth + pb_box_space) + "px";
    }
    else{
        svg.style.width = (svgBBox.width + (pb_box_space + pb_box_w)) + "px";
    }

}

/*
Elementua sortu path box-ean
*/



function pb_new_element(data_id,text_value,image_value){
	//console.log("data_id:"+data_id);
	//console.log("text_value:"+text_value);
	//console.log("image_value:"+image_value);
	
    //kokapen berria aurkitu
    var y_position = 0;
    if (paths_starts.length > 0){
        y_position = get_new_y(paper.getById(paths_starts[paths_starts.length-1]));
    }

    var back_rect = paper.rect(get_x(0), get_y(y_position), pb_box_w,pb_box_h, 5);
    back_rect.node.setAttribute("class","pb_box_back");
    back_rect.id = data_id + "_back";

    //azpi elementuak sortu
    if (text_value.length > 15){
        text_value = text_value.substring(0,12) + "...";
    }
    var text = paper.text(get_x(0)+60, get_y(y_position)+100, text_value);
    text.id = data_id + "_title";
    text.node.setAttribute("class","pb_box_title");

    var image = paper.image(image_value, get_x(0)+10, get_y(y_position)+15, pb_box_w -20, pb_box_h - 50)
    image.id = data_id + "_image";
    image.node.setAttribute("class","pb_box_image");

    var rect = paper.rect(get_x(0), get_y(y_position), pb_box_w,pb_box_h, 5);
    rect.node.setAttribute("class","pb_box");
    
    //maddalen: Modal window-a zabaltzeko gehitu ditut ondorengo bi lerroak
    //rect.node.setAttribute("data-toggle","modal");
    //rect.node.setAttribute("data-target","#myModal");
    
    rect.id = data_id;
    //beharrezko informazioa hemen gorde
    rect.data("text_value",text_value);
    rect.data("image_value",image_value);
    //diagramaren kudeaketarako beharrezko balioak
    rect.data("parent_id",null);
    rect.data("children",[]);
    rect.drag(onmove, onstart, onend);
    paths_starts.push(rect.id);
    
    var delete_button = paper.text(get_x(0)+pb_box_w-10, get_y(y_position)+10, "X");
    delete_button.id = data_id + "_delete_button";
    delete_button.node.setAttribute("class","pb_box_delete_button");
    delete_button.data("id_value",data_id);
    delete_button.click(pb_remove_me);
    
    
    /*
    //NARRAZIOA GEHITZEKO  PROMT BIDEZ
  	rect.attr({
    cursor: 'pointer',
	}).dblclick(function(e) {
    
    //var path_item_description = document.getElementById("path_item_description").value;
  	//alert("pb_new_element:"+path_item_description);
    
    var path_item_description = prompt("Itemaren narrazioa:", "");
    rect.data("item_narrazioa",path_item_description);
	}); 
	*/
	
	// NARRAZIOA GEHITZEKO Klik bikoitzaz
	rect.attr({
    cursor: 'pointer',
	}).dblclick(function(e) {
    	
    	/*
  		var narra_div = document.getElementById("narrazioa");
        
    	var input = document.createElement("textarea");
		var button = document.createElement("button");
		input.name = "textarea";
		input.id = "narra_textarea";
		input.maxLength = "5000";
		input.cols = "87";
		input.rows = "5";
	
		narra_div.appendChild(input); //appendChild
		var t = document.createTextNode("Gorde");       // Create a text node
		button.appendChild(t);
		narra_div.appendChild(button);
	*/
	
			
		//document.getElementById("narra_textarea").setAttribute("disabled","false");
        //document.getElementById("narra_botoia").setAttribute("disabled","false");   
        
        document.getElementById("narra_p").innerHTML = "Momentuko itema: "+text_value;
        
        $("[name='narra_textarea']").prop("disabled", false);
        $("[name='narra_textarea']").prop("value", '');
		$("[name='narra_botoia']").prop("disabled", false);
		
		
		
		var button = document.getElementById("narra_botoia");
		
		button.onclick = function () {
  	  		var balioa=$.trim($("textarea").val());
  			
  			//Raphael-en rect-aaren data-n gorde
  			rect.data("item_narrazioa",balioa);
			
			//kendu pantailatik textArea eta botoia
			//DIV-a ez borratu!!!! document.getElementById('narra_textarea')
			//$('#narrazioa').remove();	
			
			document.getElementById("narra_textarea").setAttribute("disabled","disabled");
        	document.getElementById("narra_botoia").setAttribute("disabled","disabled");  
			
			//Path-eko nodo hau zelabait markatu narrazioa duela jakiteko
			
			/*
			paper.rect(get_x(0), get_y(y_position), pb_box_w,pb_box_h, 5).attr({
			//fill: "red", 
			stroke: "rgb(200,100,77)",
			"stroke-width": 5
			});*/
		};
	}); 
	
	//N botoia
/*
    var narra_button = paper.text(get_x(0)+pb_box_w-30, get_y(y_position)+10, "N");
    narra_button.id = data_id + "_narra_button";
    narra_button.node.setAttribute("class","pb_box_delete_button");
    narra_button.data("id_value",data_id);
    //narra_button.click(pb_narra_me);
    
    
    narra_button.click(function(e){
    	//pb_narra_me
    
    	var narra_div = document.getElementById("narrazioa");
        
    	var input = document.createElement("textarea");
		var button = document.createElement("button");
		input.name = "textarea";
		input.maxLength = "5000";
		input.cols = "87";
		input.rows = "5";
	
		narra_div.appendChild(input); //appendChild
		var t = document.createTextNode("Gorde");       // Create a text node
		button.appendChild(t);
		narra_div.appendChild(button);
	
		button.onclick = function () {
  	  		var balioa=$.trim($("textarea").val());
  			alert(balioa);
  			//Raphael-en rect-aaren data-n gorde
  			rect.data("item_narrazioa",balioa);
			
			//kendu pantailatik textArea eta botoia
			$('#narrazioa').remove();	
			
			//Path-eko nodo hau zelabait markatu narrazioa duela jakiteko
			
			
//			paper.rect(get_x(0), get_y(y_position), pb_box_w,pb_box_h, 5).attr({
			//fill: "red", 
//			stroke: "rgb(200,100,77)",
//			"stroke-width": 5
//			});
		};
    	
    });
    */
   
    pb_window_resize();
}

//Maddalen, aurreko funtzioaren kopia bat da, baina X botoia ez du sortzen ezta narrazioa
//Gainera, Ibilbideen nabigaziorako beahrrezkoa diren datuak gordeko ditugu .data-n: path_id

function pb_new_element_egunekoa(data_id,text_value,image_value,path_id,item_id){
	
	
    //kokapen berria aurkitu
    var y_position = 0;
    if (paths_starts.length > 0){
        y_position = get_new_y(paper.getById(paths_starts[paths_starts.length-1]));
    }

    var back_rect = paper.rect(get_x(0), get_y(y_position), pb_box_w,pb_box_h, 5);
    back_rect.node.setAttribute("class","pb_box_back");
    back_rect.id = data_id + "_back";

    //azpi elementuak sortu
    if (text_value.length > 15){
        text_value = text_value.substring(0,12) + "...";
    }
    var text = paper.text(get_x(0)+60, get_y(y_position)+100, text_value);
    text.id = data_id + "_title";
    text.node.setAttribute("class","pb_box_title");

    var image = paper.image(image_value, get_x(0)+10, get_y(y_position)+15, pb_box_w -20, pb_box_h - 50)
    image.id = data_id + "_image";
    image.node.setAttribute("class","pb_box_image");

    var rect = paper.rect(get_x(0), get_y(y_position), pb_box_w,pb_box_h, 5);
    rect.node.setAttribute("class","pb_box");
    
        
    rect.id = data_id;
    //beharrezko informazioa hemen gorde
    rect.data("text_value",text_value);
    rect.data("image_value",image_value);
    //diagramaren kudeaketarako beharrezko balioak
    rect.data("parent_id",null);
    rect.data("children",[]);
    
    //Nabigaziorako beharrezkoak diren datuak kargatu
    /*
    rect.data("path_id",path_id);
    rect.data("narrazioa",narrazioa);
    rect.data("hurrengoak_id",hurrengoak_id);
    rect.data("hasieraDa",hasieraDa);
    */
    //var node_id = data_id.replace("pb_", "");
    //rect.data("node_id",node_id);
    
    //rect.drag(onmove, onstart, onend); //MAddalen: ez utzi erabiltzaileari nodoak mugitzen
    paths_starts.push(rect.id);
    
    
    // NABIGAZIOA GEHITZEKO
	rect.attr({
    cursor: 'pointer',
	}).click(function(e) {
    	
    	
    	var url = 'nabigazio_item';
    	
    	//window.location.href=url; //get moduan bidaltzeko
		
		
		var form = $('<form action="' + url + '" method="post">' +
		'<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">'+
  		'<input type="hidden" name="path_id" value="' + path_id + '" />'+
  		//'<input type="hidden" name="titulua" value="' + text_value + '" />'+
  		//'<input type="hidden" name="irudia" value="' + image_value + '" />'+
  		//'<input type="hidden" name="narrazioa" value="' + narrazioa + '" />'+
  		//'<input type="hidden" name="hurrengoak_id" value="' + hurrengoak_id + '" />'+
  		//'<input type="hidden" name="hasieraDa" value="' + hasieraDa + '" />'+
  		'<input type="hidden" name="item_id" value="' + item_id + '" />'+
 		 '</form>');
		$('body').append(form);
		form.submit();
    
   	});
   
    pb_window_resize();
}

function pb_new_element_overview(data_id,text_value,path_id,item_id,nabarmentzeko_id)
{
	
	//kokapen berria aurkitu
    var y_position = 0;
    if (paths_starts.length > 0){
        y_position = get_new_y(paper.getById(paths_starts[paths_starts.length-1]));
    }
	//Maddalen: heigh-70, width-30
    var back_rect = paper.rect(get_x(0), get_y(y_position), pb_box_w-30,pb_box_h-70, 5);
    
    if (item_id==nabarmentzeko_id)
    {
    	back_rect.node.setAttribute("class","pb_box_back_nabarmendu");
    }
    else
    {
    	back_rect.node.setAttribute("class","pb_box_back_overview");
    }
    back_rect.id = data_id + "_back";

    //azpi elementuak sortu
    if (text_value.length > 15){
        text_value = text_value.substring(0,12) + "...";
    }
    //Maddalen:y+30
    var text = paper.text(get_x(0)+60, get_y(y_position)+30, text_value);
    text.id = data_id + "_title";
    text.node.setAttribute("class","pb_box_title");

	//Maddalen:heigh-70, width-30
    var rect = paper.rect(get_x(0), get_y(y_position), pb_box_w-30,pb_box_h-70, 5);
    rect.node.setAttribute("class","pb_box_overview");
    
    
    //MOMENTUKO NODEA NABARMENDU (BESTE KOLORE BAT EMAN ADIBIDEZ)
        
    rect.id = data_id;
    //beharrezko informazioa hemen gorde
    rect.data("text_value",text_value);
    //diagramaren kudeaketarako beharrezko balioak
    rect.data("parent_id",null);
    rect.data("children",[]);
    
    paths_starts.push(rect.id);
    
    
    // NABIGAZIOA GEHITZEKO
	rect.attr({
    cursor: 'pointer',
	}).click(function(e) {   	
    	
    	var url = 'nabigazio_item';   	
    	//window.location.href=url; //get moduan bidaltzeko				
		var form = $('<form action="' + url + '" method="post">' +
		'<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">'+
  		'<input type="hidden" name="path_id" value="' + path_id + '" />'+  		
  		'<input type="hidden" name="item_id" value="' + item_id + '" />'+
 		 '</form>');
		$('body').append(form);
		form.submit();
    
   	});
   
    pb_window_resize();
	
}


function nabigatu(path_id,node_id)
{

	//ALA nabigazio_item-era zuzenean?
	var url = 'nabigatu?path_id='+path_id+'&item_id='+node_id+'&autoplay=0';   	
    window.location.href=url;
	
}

//get new element y size
function get_new_y(el){
    if (el){
        var children = el.data("children");
        if (children && (children.length > 0)){
            return get_new_y(paper.getById(children[children.length-1]));
        }
        else{
            return get_y_pos(el.attr("y")) + 1;
        }
    }
    return 0;
}

//geziak eguneratu
function update_arrows(pb_box){
    if (pb_box){
        for (var i = connections.length; i--;) {
            if ((connections[i].to == pb_box) || (connections[i].from == pb_box)){
                paper.connection(connections[i]);
            }
        }
    }
    else{
        for (var i = connections.length; i--;) {
            paper.connection(connections[i]);
        }
    }
}

function onmove(dx,dy,x0,y0,ev){
    //elementua mugitu
    this.attr({x: this.ox + dx, y: this.oy + dy});
    //azpi elementuak mugitu
    var back = paper.getById(this.id + "_back");
    back.attr({x: back.ox + dx, y: back.oy + dy});
    var text = paper.getById(this.id + "_title");
    text.attr({x: text.ox + dx, y: text.oy + dy});
    var image = paper.getById(this.id + "_image");
    image.attr({x: image.ox + dx, y: image.oy + dy});
    var delete_button = paper.getById(this.id + "_delete_button");
    delete_button.attr({x: delete_button.ox + dx, y: delete_button.oy + dy});
    var rect = document.getElementById("path_boxes").getBoundingClientRect();
    var x = x0 - rect.left - window.pageXOffset + paper.canvas.parentNode.scrollLeft, y = y0 - rect.top - window.pageYOffset + paper.canvas.parentNode.scrollTop;
    var me = this;
    var found = false;
    paper.getElementsByPoint(x, y).forEach(function(e){
            if (e.node.classList.contains("pb_box") && (e.id != me.id)){
                me.data("hover_id",e.id);
                paper.getById(e.id + "_back").node.classList.add("pb_box_back_moving");
                found = true;
            }
    });
    if (!found){
        if (this.data("hover_id")){
            paper.getById(this.data("hover_id") + "_back").node.classList.remove("pb_box_back_moving");
            me.removeData("hover_id");
        }
    }
    update_arrows();
}

function onstart(x,y,ev){
    //azpi elementuak aurrera bota
    var back = paper.getById(this.id + "_back");
    back.ox = back.attr("x");
    back.oy = back.attr("y");
    back.toFront();
    var text = paper.getById(this.id + "_title");
    text.ox = text.attr("x");
    text.oy = text.attr("y");
    text.toFront();
    var image = paper.getById(this.id + "_image");
    image.ox = image.attr("x");
    image.oy = image.attr("y");
    image.toFront();
    //elementua aurrera bota
    this.ox = this.attr("x");
    this.oy = this.attr("y");
    this.toFront();
    //ezabatzeko botoia aurrera bota
    var delete_button = paper.getById(this.id + "_delete_button");
    delete_button.ox = delete_button.attr("x");
    delete_button.oy = delete_button.attr("y");
    delete_button.toFront();
    paper.getById(this.id + "_back").node.classList.add("pb_box_back_moving");
}

function onend(ev){
    var old_parent_id = this.data("parent_id");
    if (this.data("hover_id") && (old_parent_id != paper.getById(this.data("hover_id")).id)){
        var new_parent = paper.getById(this.data("hover_id"));
        pb_remove_box(this,false);
        pb_add_son(new_parent,this);
        paper.getById(new_parent.id + "_back").node.classList.remove("pb_box_back_moving");
        paper.getById(this.id + "_back").node.classList.remove("pb_box_back_moving");
    }
    else{
        //elementua mugitu
        this.attr({x: this.ox, y: this.oy});
        //azpi elementuak mugitu
        var back = paper.getById(this.id + "_back");
        back.attr({x: back.ox, y: back.oy});
        var text = paper.getById(this.id + "_title");
        text.attr({x: text.ox, y: text.oy});
        var image = paper.getById(this.id + "_image");
        image.attr({x: image.ox, y: image.oy});
        var delete_button = paper.getById(this.id + "_delete_button");
        delete_button.attr({x: delete_button.ox, y: delete_button.oy});
        paper.getById(this.id + "_back").node.classList.remove("pb_box_back_moving");
        update_arrows(this);
        //itzala kendu
        if (this.data("hover_id")){
            paper.getById(this.data("hover_id") + "_back").node.classList.remove("pb_box_back_moving");
            this.removeData("hover_id");
        }
    }
    pb_window_resize();
}

/*
Ezabatu bere burua
*/
function pb_remove_me(){
    pb_remove_box(paper.getById(this.data("id_value")),true);
    pb_window_resize();
}
/*
Narrazioa gehitzeko funtzioa
*/
/*
function pb_narra_me(){
	alert("pb_narra_me");
	alert(this.data("id_value"));

	//pb_remove_box(paper.getById(this.data("id_value")),true);
    //pb_window_resize();
    
    var narra_div = document.getElementById("narrazioa");
        
    var input = document.createElement("textarea");
	var button = document.createElement("button");
	input.name = "textarea";
	input.maxLength = "5000";
	input.cols = "87";
	input.rows = "5";
	
	narra_div.appendChild(input); //appendChild
	var t = document.createTextNode("Gorde");       // Create a text node
	button.appendChild(t);
	narra_div.appendChild(button);
	
	button.onclick = function () {
  		alert("blabla");
  		var balioa=$.trim($("textarea").val());
  		alert(balioa);
  		//Raphael-en rect-aaren data-n gorde
  		//this.rect.data("item_narrazioa",balioa);
  		//paper.getById(this.data("id_value")).rect.data("item_narrazioa",balioa);
  		
	};
    
    
   
  
}
*/

/*
Ezabatu elementua:
    
    elementua workspacera bidaltzen du
    erlazionaturiko gezi guztiak ezabatu
    azpi elementuak ezabatzen ditu
    bere burua ezabatzen du

aparte egin beharrekoa:
    
    azpian dauden elementuak maila bat igo
*/
function pb_remove_box(pb_box,delete_element){
    var old_parent_id = pb_box.data("parent_id");
    var children = pb_box.data("children");
    if (old_parent_id){
        var old_parent = paper.getById(old_parent_id);
        if (children.length > 0){
            pb_children_left(pb_box);
        }
        else if (old_parent.data("children").length > 1){
            pb_brothers_up(pb_box);
        }
        old_parent.data("children").splice(old_parent.data("children").indexOf(pb_box.id),1);
        for (var i = connections.length; i--;) {
            if ((connections[i].to == pb_box)){
                connections[i].line.remove();
                connections.splice(i,1);
                break;
            }
        }
    }
    else{
        if (children.length > 0){
            pb_children_left(pb_box);
        }
        else{
            pb_brothers_up(pb_box);
        }
        paths_starts.splice(paths_starts.indexOf(pb_box.id),1);
    }
    update_arrows();
    if (delete_element){
        //workspace-an sortu elementua
        var box_id = pb_box.id;
        var text_value = pb_box.data("text_value");
        var image_value = pb_box.data("image_value");
        add_workspace_box(box_id,text_value,image_value);
        //ezabatu azpi elementuak
        paper.getById(pb_box.id + "_back").remove();
        paper.getById(pb_box.id + "_title").remove();
        paper.getById(pb_box.id + "_image").remove();
        paper.getById(pb_box.id + "_delete_button").remove();
        //ezabatu elementua
        pb_box.remove();
    }
}


/*
Semeak ezkerretara mugitu:
    guraso berria esleitu edo erro bezala ezarri
    pb_move_left funtzioa aplikatu elementuari
    elementu eta azpi-elementu guztiak ezkerrera mugitu
    geziak eguneratu
*/
function pb_children_left(parent){
    var children = parent.data("children");
    parent.data("children",[]);
    for (var c=0;c<children.length; c++){
        var child = paper.getById(children[c]);
        //gurasoak gurasorik badu, elementuaren guraso berria bihurtuko da
        if (parent.data("parent_id")){
            //geziak ezabatu
            for (var i = connections.length; i--;) {
                if ((connections[i].to == child) && (connections[i].from == parent)){
                    connections[i].line.remove();
                    connections.splice(i,1);
                    break;
                }
            }
            var new_parent = paper.getById(parent.data("parent_id"));
            var connection = paper.connection(new_parent,child, "#000");
            connections.push(connection);
            new_parent.data("children").splice(new_parent.data("children").indexOf(parent.id),0,child.id);
            child.data("parent_id",new_parent.id);
        }
        //bestela erro elementua bihurtuko da
        else{
            //geziak ezabatu
            for (var i = connections.length; i--;) {
                if ((connections[i].to == child) && (connections[i].from == parent)){
                    connections[i].line.remove();
                    connections.splice(i,1);
                    break;
                }
            }
            paths_starts.splice(paths_starts.indexOf(parent.id),0,child.id);
            child.data("parent_id",null);
        }
        //elementua eta azpi elementuak mugitu
        pb_move_left(child);
    }
    update_arrows();
}

/*
Elementuak ezkerretara mugitu:
    x - 1 aplikatu elementuei
    seme bakoitzari ere deia aplikatu
*/
function pb_move_left(pb_box){
    //elementua mugitu
    pb_box.attr({x: pb_box.attr("x") - (pb_box_space + pb_box_w), y: pb_box.attr("y")});
    //azpi elementuak mugitu
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x") - (pb_box_space + pb_box_w), y: back.attr("y")});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x") - (pb_box_space + pb_box_w), y: text.attr("y")});
    var image = paper.getById(pb_box.id + "_image");
    image.attr({x: image.attr("x") - (pb_box_space + pb_box_w), y: image.attr("y")});
    var delete_button = paper.getById(pb_box.id + "_delete_button");
    delete_button.attr({x: delete_button.attr("x") - (pb_box_space + pb_box_w), y: delete_button.attr("y")});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_left(paper.getById(children[c]));
    }
}

/*
Elementu anaiak igo:
    anaiei pb_move_up aplikatu continue false
    gurasoak azpi-anairik duen konprobatu, hauei pb_move_up aplikatu continue false
    guraso gabeko azken gurasoa hartzean, erro zerrendatik hurrengo elementuak hartu eta hauei pb_move_up aplikatu
*/

function pb_brothers_up(pb_box){
    var parent_id = pb_box.data("parent_id");
    if (parent_id){
        var parent = paper.getById(parent_id);
        var next_children = parent.data("children").slice(parent.data("children").indexOf(pb_box.id)+1);
        for (var c=0;c<next_children.length; c++) {
            pb_move_up(paper.getById(next_children[c]));
        }
        pb_brothers_up(parent);
    }
    else{
        var next_paths_starts = paths_starts.slice(paths_starts.indexOf(pb_box.id)+1);
        for (var c=0;c<next_paths_starts.length; c++) {
            pb_move_up(paper.getById(next_paths_starts[c]));
        }
    }
}

function pb_brothers_up_egunekoa(pb_box){
    var parent_id = pb_box.data("parent_id");
    if (parent_id){
        var parent = paper.getById(parent_id);
        var next_children = parent.data("children").slice(parent.data("children").indexOf(pb_box.id)+1);
        for (var c=0;c<next_children.length; c++) {
            pb_move_up_egunekoa(paper.getById(next_children[c]));
        }
        pb_brothers_up_egunekoa(parent);
    }
    else{
        var next_paths_starts = paths_starts.slice(paths_starts.indexOf(pb_box.id)+1);
        for (var c=0;c<next_paths_starts.length; c++) {
            pb_move_up_egunekoa(paper.getById(next_paths_starts[c]));
        }
    }
}

function pb_brothers_up_overview(pb_box){
    var parent_id = pb_box.data("parent_id");
    if (parent_id){
        var parent = paper.getById(parent_id);
        var next_children = parent.data("children").slice(parent.data("children").indexOf(pb_box.id)+1);
        for (var c=0;c<next_children.length; c++) {
            pb_move_up_overview(paper.getById(next_children[c]));
        }
        pb_brothers_up_overview(parent);
    }
    else{
        var next_paths_starts = paths_starts.slice(paths_starts.indexOf(pb_box.id)+1);
        for (var c=0;c<next_paths_starts.length; c++) {
            pb_move_up_overview(paper.getById(next_paths_starts[c]));
        }
    }
}

/*
Elementuak gora:
    errekurtsiboa da.
    y - 1 aplikatu elementuei
    seme bakoitzari ere deia aplikatu
*/
function pb_move_up(pb_box){
    //elementuak mugitu
    pb_box.attr({x: pb_box.attr("x"), y: pb_box.attr("y") - (pb_box_space + pb_box_h)});
    //azpi elementuak mugitu
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x"), y: back.attr("y") - (pb_box_space + pb_box_h)});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x"), y: text.attr("y") - (pb_box_space + pb_box_h)});
    var image = paper.getById(pb_box.id + "_image");
    image.attr({x: image.attr("x"), y: image.attr("y") - (pb_box_space + pb_box_h)});
    var delete_button = paper.getById(pb_box.id + "_delete_button");
    delete_button.attr({x: delete_button.attr("x"), y: delete_button.attr("y") - (pb_box_space + pb_box_h)});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_up(paper.getById(children[c]));
    }
}

function pb_move_up_egunekoa(pb_box){
    //elementuak mugitu
    pb_box.attr({x: pb_box.attr("x"), y: pb_box.attr("y") - (pb_box_space + pb_box_h)});
    //azpi elementuak mugitu
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x"), y: back.attr("y") - (pb_box_space + pb_box_h)});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x"), y: text.attr("y") - (pb_box_space + pb_box_h)});
    var image = paper.getById(pb_box.id + "_image");
    image.attr({x: image.attr("x"), y: image.attr("y") - (pb_box_space + pb_box_h)});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_up_egunekoa(paper.getById(children[c]));
    }
}

function pb_move_up_overview(pb_box){
    //elementuak mugitu
    pb_box.attr({x: pb_box.attr("x"), y: pb_box.attr("y") - (pb_box_space + pb_box_h)});
    //azpi elementuak mugitu
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x"), y: back.attr("y") - (pb_box_space + pb_box_h)});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x"), y: text.attr("y") - (pb_box_space + pb_box_h)});
    //var image = paper.getById(pb_box.id + "_image");
    //image.attr({x: image.attr("x"), y: image.attr("y") - (pb_box_space + pb_box_h)});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_up_overview(paper.getById(children[c]));
    }
}


function pb_add_new_son(parent_id,data_id,text_value,image_value){
    var parent = paper.getById(parent_id);
    pb_new_element(data_id,text_value,image_value);
    var new_son = paper.getById(data_id);
    pb_brothers_up(new_son);
    paths_starts.splice(paths_starts.indexOf(data_id),1);
    pb_add_son(parent,new_son);
}

function pb_add_new_son_egunekoa(parent_id,data_id,text_value,image_value,path_id,node_id){
    var parent = paper.getById(parent_id);
    pb_new_element_egunekoa(data_id,text_value,image_value,path_id,node_id); //nabigaziorako 
    var new_son = paper.getById(data_id);
    pb_brothers_up_egunekoa(new_son);
    paths_starts.splice(paths_starts.indexOf(data_id),1);
    pb_add_son_egunekoa(parent,new_son);
}

function pb_add_new_son_overview(parent_id,data_id,text_value,path_id,node_id,nabarmentzeko_id){
    var parent = paper.getById(parent_id);
    pb_new_element_overview(data_id,text_value,path_id,node_id,nabarmentzeko_id); 
    var new_son = paper.getById(data_id);
    pb_brothers_up_overview(new_son);
    paths_starts.splice(paths_starts.indexOf(data_id),1);
    pb_add_son_overview(parent,new_son);
}

/*
Semea gehitu:
    semea gehitu eta dagokion marra
    esleitu gurasoa
    anaiak baditu:
        gurasoak azpi-anairik badu jaitsi +1 eta honen semeei errekurtsiboki
        guraso gabeko azken gurasoa hartzena, erro zerrendatik hurrengo elementuak hartu eta hauei pb_move_down aplikatu
*/
function pb_add_son(parent,pb_box){
    var back = paper.getById(pb_box.id + "_back");
    var text = paper.getById(pb_box.id + "_title");
    var image = paper.getById(pb_box.id + "_image");
    var delete_button = paper.getById(pb_box.id + "_delete_button");
    if (parent.data("children").length > 0){
        pb_brothers_down(parent);
        update_arrows();
        var last_son = paper.getById(parent.data("children")[parent.data("children").length-1]);
        y_position = get_new_y(last_son);
        //elementua mugitu
        pb_box.attr({x: last_son.attr("x"), y: get_y(y_position)});
        //azpi elementuak mugitu
        back.attr({x: last_son.attr("x"), y: get_y(y_position)});
        text.attr({x: last_son.attr("x") + 60, y: get_y(y_position) + 100});
        image.attr({x: last_son.attr("x") + 5, y: get_y(y_position) + 5});
        delete_button.attr({x: last_son.attr("x")+pb_box_w-10, y: get_y(y_position) + 10});
    }
    else{
        //elementua mugitu
        pb_box.attr({x: parent.attr("x") + (pb_box_space + pb_box_w), y: parent.attr("y")});
        //azpi elementuak mugitu
        back.attr({x: parent.attr("x") + (pb_box_space + pb_box_w), y: parent.attr("y")});
        text.attr({x: parent.attr("x") + (pb_box_space + pb_box_w) + 60, y: parent.attr("y") + 100});
        image.attr({x: parent.attr("x") + (pb_box_space + pb_box_w) + 5, y: parent.attr("y") + 5});
        delete_button.attr({x: parent.attr("x") + (pb_box_space + pb_box_w) + pb_box_w -10, y: parent.attr("y") + 10});
    }
    parent.data("children").push(pb_box.id);
    pb_box.data("parent_id",parent.id);
    var connection = paper.connection(parent,pb_box, "#000");
    connections.push(connection);
}

//MAddalen
function pb_add_son_egunekoa(parent,pb_box){
    var back = paper.getById(pb_box.id + "_back");
    var text = paper.getById(pb_box.id + "_title");
    var image = paper.getById(pb_box.id + "_image");
    
    if (parent.data("children").length > 0){
        pb_brothers_down_egunekoa(parent);
        update_arrows();
        var last_son = paper.getById(parent.data("children")[parent.data("children").length-1]);
        y_position = get_new_y(last_son);
        //elementua mugitu
        pb_box.attr({x: last_son.attr("x"), y: get_y(y_position)});
        //azpi elementuak mugitu
        back.attr({x: last_son.attr("x"), y: get_y(y_position)});
        text.attr({x: last_son.attr("x") + 60, y: get_y(y_position) + 100});
        image.attr({x: last_son.attr("x") + 5, y: get_y(y_position) + 5});
       
    }
    else{
        //elementua mugitu
        pb_box.attr({x: parent.attr("x") + (pb_box_space + pb_box_w), y: parent.attr("y")});
        //azpi elementuak mugitu
        back.attr({x: parent.attr("x") + (pb_box_space + pb_box_w), y: parent.attr("y")});
        text.attr({x: parent.attr("x") + (pb_box_space + pb_box_w) + 60, y: parent.attr("y") + 100});
        image.attr({x: parent.attr("x") + (pb_box_space + pb_box_w) + 5, y: parent.attr("y") + 5});
        
    }
    parent.data("children").push(pb_box.id);
    pb_box.data("parent_id",parent.id);
    var connection = paper.connection(parent,pb_box, "#000");
    connections.push(connection);
}

function pb_add_son_overview(parent,pb_box){
    var back = paper.getById(pb_box.id + "_back");
    var text = paper.getById(pb_box.id + "_title");
    
    
    if (parent.data("children").length > 0){
        pb_brothers_down_overview(parent);
        update_arrows();
        var last_son = paper.getById(parent.data("children")[parent.data("children").length-1]);
        y_position = get_new_y(last_son);
        //elementua mugitu
        pb_box.attr({x: last_son.attr("x"), y: get_y(y_position)});
        //azpi elementuak mugitu
        back.attr({x: last_son.attr("x"), y: get_y(y_position)});
        //Maddalen: +30
        text.attr({x: last_son.attr("x") + 60, y: get_y(y_position) + 30});
        
       
    }
    else{
        //elementua mugitu
        pb_box.attr({x: parent.attr("x") + (pb_box_space + pb_box_w), y: parent.attr("y")});
        //azpi elementuak mugitu
        back.attr({x: parent.attr("x") + (pb_box_space + pb_box_w), y: parent.attr("y")});
        //Maddalen: +30
        text.attr({x: parent.attr("x") + (pb_box_space + pb_box_w) + 60, y: parent.attr("y") + 30});
       
    }
    parent.data("children").push(pb_box.id);
    pb_box.data("parent_id",parent.id);
    var connection = paper.connection(parent,pb_box, "#000");
    connections.push(connection);
}

/*
Anaiak eta hurrengoak behera mugitu
*/
function pb_brothers_down(pb_box){
    var parent_id = pb_box.data("parent_id");
    if (parent_id){
        var parent = paper.getById(parent_id);
        var next_children = parent.data("children").slice(parent.data("children").indexOf(pb_box.id)+1);
        for (var c=0;c<next_children.length; c++) {
            pb_move_down(paper.getById(next_children[c]));
        }
        pb_brothers_down(parent);
    }
    else{
        var next_paths_starts = paths_starts.slice(paths_starts.indexOf(pb_box.id)+1);
        for (var c=0;c<next_paths_starts.length; c++) {
            pb_move_down(paper.getById(next_paths_starts[c]));
        }
    }
}

function pb_brothers_down_egunekoa(pb_box){
    var parent_id = pb_box.data("parent_id");
    if (parent_id){
        var parent = paper.getById(parent_id);
        var next_children = parent.data("children").slice(parent.data("children").indexOf(pb_box.id)+1);
        for (var c=0;c<next_children.length; c++) {
            pb_move_down_egunekoa(paper.getById(next_children[c]));
        }
        pb_brothers_down_egunekoa(parent);
    }
    else{
        var next_paths_starts = paths_starts.slice(paths_starts.indexOf(pb_box.id)+1);
        for (var c=0;c<next_paths_starts.length; c++) {
            pb_move_down_egunekoa(paper.getById(next_paths_starts[c]));
        }
    }
}

function pb_brothers_down_overview(pb_box){
    var parent_id = pb_box.data("parent_id");
    if (parent_id){
        var parent = paper.getById(parent_id);
        var next_children = parent.data("children").slice(parent.data("children").indexOf(pb_box.id)+1);
        for (var c=0;c<next_children.length; c++) {
            pb_move_down_overview(paper.getById(next_children[c]));
        }
        pb_brothers_down_overview(parent);
    }
    else{
        var next_paths_starts = paths_starts.slice(paths_starts.indexOf(pb_box.id)+1);
        for (var c=0;c<next_paths_starts.length; c++) {
            pb_move_down_overview(paper.getById(next_paths_starts[c]));
        }
    }
}

/*
Elementuak gora:
    errekurtsiboa da.
    y + 1 aplikatu elementuei
    seme bakoitzari ere deia aplikatu
*/
function pb_move_down(pb_box){
    pb_box.attr({x: pb_box.attr("x"), y: pb_box.attr("y") + (pb_box_space + pb_box_h)});
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x"), y: back.attr("y") + (pb_box_space + pb_box_h)});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x"), y: text.attr("y") + (pb_box_space + pb_box_h)});
    var image = paper.getById(pb_box.id + "_image");
    image.attr({x: image.attr("x"), y: image.attr("y") + (pb_box_space + pb_box_h)});
    var delete_button = paper.getById(pb_box.id + "_delete_button");
    delete_button.attr({x: delete_button.attr("x"), y: delete_button.attr("y") + (pb_box_space + pb_box_h)});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_down(paper.getById(children[c]));
    }
}

//Maddalen, aurreko funtzioaren kopia da
function pb_move_down_egunekoa(pb_box){
    pb_box.attr({x: pb_box.attr("x"), y: pb_box.attr("y") + (pb_box_space + pb_box_h)});
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x"), y: back.attr("y") + (pb_box_space + pb_box_h)});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x"), y: text.attr("y") + (pb_box_space + pb_box_h)});
    var image = paper.getById(pb_box.id + "_image");
    image.attr({x: image.attr("x"), y: image.attr("y") + (pb_box_space + pb_box_h)});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_down_egunekoa(paper.getById(children[c]));
    }
}

function pb_move_down_overview(pb_box){
    pb_box.attr({x: pb_box.attr("x"), y: pb_box.attr("y") + (pb_box_space + pb_box_h)});
    var back = paper.getById(pb_box.id + "_back");
    back.attr({x: back.attr("x"), y: back.attr("y") + (pb_box_space + pb_box_h)});
    var text = paper.getById(pb_box.id + "_title");
    text.attr({x: text.attr("x"), y: text.attr("y") + (pb_box_space + pb_box_h)});
    //var image = paper.getById(pb_box.id + "_image");
    //image.attr({x: image.attr("x"), y: image.attr("y") + (pb_box_space + pb_box_h)});
    var children = pb_box.data("children");
    for (var c=0;c<children.length; c++){
        pb_move_down_overview(paper.getById(children[c]));
    }
}



Raphael.fn.connection = function (obj1, obj2, line, bg) {
    if (obj1.line && obj1.from && obj1.to) {
        line = obj1;
        obj1 = line.from;
        obj2 = line.to;
    }
    var bb1 = obj1.getBBox(),
        bb2 = obj2.getBBox(),
        p = [{x: bb1.x + bb1.width / 2, y: bb1.y - 1},
        {x: bb1.x + bb1.width / 2, y: bb1.y + bb1.height + 1},
        {x: bb1.x - 1, y: bb1.y + bb1.height / 2},
        {x: bb1.x + bb1.width + 1, y: bb1.y + bb1.height / 2},
        {x: bb2.x + bb2.width / 2, y: bb2.y - 1},
        {x: bb2.x + bb2.width / 2, y: bb2.y + bb2.height + 1},
        {x: bb2.x - 1, y: bb2.y + bb2.height / 2},
        {x: bb2.x + bb2.width + 1, y: bb2.y + bb2.height / 2}],
        d = {}, dis = [];
    for (var i = 0; i < 4; i++) {
        for (var j = 4; j < 8; j++) {
            var dx = Math.abs(p[i].x - p[j].x),
                dy = Math.abs(p[i].y - p[j].y);
            if ((i == j - 4) || (((i != 3 && j != 6) || p[i].x < p[j].x) && ((i != 2 && j != 7) || p[i].x > p[j].x) && ((i != 0 && j != 5) || p[i].y > p[j].y) && ((i != 1 && j != 4) || p[i].y < p[j].y))) {
                dis.push(dx + dy);
                d[dis[dis.length - 1]] = [i, j];
            }
        }
    }
    if (dis.length == 0) {
        var res = [0, 4];
    } else {
        res = d[Math.min.apply(Math, dis)];
    }
    var x1 = p[res[0]].x,
        y1 = p[res[0]].y,
        x4 = p[res[1]].x,
        y4 = p[res[1]].y;
    dx = Math.max(Math.abs(x1 - x4) / 2, 10);
    dy = Math.max(Math.abs(y1 - y4) / 2, 10);
    var x2 = [x1, x1, x1 - dx, x1 + dx][res[0]].toFixed(3),
        y2 = [y1 - dy, y1 + dy, y1, y1][res[0]].toFixed(3),
        x3 = [0, 0, 0, 0, x4, x4, x4 - dx, x4 + dx][res[1]].toFixed(3),
        y3 = [0, 0, 0, 0, y1 + dy, y1 - dy, y4, y4][res[1]].toFixed(3);
    var path = ["M", x1.toFixed(3), y1.toFixed(3), "C", x2, y2, x3, y3, x4.toFixed(3), y4.toFixed(3)].join(",");
    if (line && line.line) {
        line.bg && line.bg.attr({path: path});
        line.line.attr({path: path});
    } else {
        var color = typeof line == "string" ? line : "#000";
        return {
            bg: bg && bg.split && this.path(path).attr({stroke: bg.split("|")[0], fill: "none", "stroke-width": bg.split("|")[1] || 3}),
            line: this.path(path).attr({stroke: color, fill: "none"}),
            from: obj1,
            to: obj2
        };
    }
};

function ibilbidea_kargatu(path_id)
{
	
	var path_id=path_id;
	//Datu-basetik erroak direnak lortu ->pb_new_element
	
	//Datu-basetik semeak lortzen joan ->pb_add_new_son
	/*
	  pb_new_element("box_1","Aita Donostiari omenaldia : ikonografi erreportaia","http://hedatuz.euskomedia.org/7031/1/03109132.pdf.png");
        pb_add_new_son("box_1","box_2","Legendarias regatas de traineras: las primeras dcadas en el asentamiento del deporte de Remo de Banco Fijo en el Cantbrico (1844-1871)","http://hedatuz.euskomedia.org/8432/1/33341360.pdf.png");
        pb_new_element("box_3","Aquarium: 100 aos de Historia","http://www.euskomedia.org/MusicGaler/foto/74_aquarium.jpg");
        pb_add_new_son("box_3","box_4","Celebracin de la Tamborrada en Donostia-San Sebastin (Gipuzkoa) la madrugada del 20 de enero.","http://www.euskomedia.org/MusicGaler/foto/v000070.jpg");
        pb_add_new_son("box_3","box_5","Gran Casino Kursaal","http://www.euskomedia.org/ImgsGaler/onati/OAA00220.jpg");
        
	 */
}

</script>

<script>
	
var rows = 10;
var text_buffer= "";
var solr_url="http://localhost:8983/solr/";

//load article
function load_search(){
    var search_text = get_url_post("search_text");
    if (search_text != ""){
        document.getElementById("search_input").value = search_text;
        make_search();
    }
}

//update offset
function update_offset(offset){
    var h_search_box = document.getElementById("h_search_box");
    var h_search_language = document.getElementById("h_search_language");
    var h_multilingual = document.getElementById("h_multilingual");
    var h_search_area = document.getElementById("h_search_area");
    var h_search_order = document.getElementById("h_search_order");
    var doc_list = document.getElementById("search_results");
    remove_content(doc_list);
    make_search_request(h_search_box.value,h_search_language.value,Boolean(h_multilingual.value),h_search_area.value,h_search_order.value,(parseInt(offset)-1)*rows);
}

//make search
function make_search(){
	start_loader();
    var search_text = document.getElementById("search_input").value.trim();
    var search_language = document.getElementById("language_select").value;
    $('input[name="genderS"]:checked').val();
    //var multilingual = document.getElementById("multilingual").checked;
    var multilingual = 1;
    //var search_area = document.getElementById("search_area_select").value;
    //var search_order =  document.getElementById("search_order_select").value;
    //var doc_list = document.getElementById("search_results");
    //var suggestion_box = document.getElementById("suggestion_box");
    //var offset_s = document.getElementById("offset");
    //suggestion_box.style.visibility = "hidden";
    //offset_s.setAttribute("disabled","disabled");
    //remove_content(doc_list);
    //remove_content(offset);
    if (search_text != ""){
        make_search_request(search_text,search_language,multilingual,search_area,search_order);
    }else{
		show_bs_message("empty_search_error");
        stop_loader();
    }
}

//make search request
function make_search_request(search_text,search_language,multilingual,search_area,search_order,offset,corrected_query){
    if (!offset){
        offset = 0;
    }
	if (!corrected_query){
        corrected_query = false;
    }
	var xmlHttp = createXmlHttpRequestObject();
	if (xmlHttp.readyState == 4 || xmlHttp.readyState == 0){
        var search_url = solr_url + "collection1/select";
        search_url = search_url + "?q=";
        var word_list = search_text.match(/".*?"|\S+/g);
        for (var index=0;index<word_list.length;index++){
            if (word_list[index] != ""){
                if (search_language == 0 || search_language == 1){
                    if (search_area > 1){
                        search_url = search_url + " title_leu:" + word_list[index] + "^1.5";
                    }
                    else{
                        search_url = search_url + " text_leu:" + word_list[index] + "^1.5";
                    }
                    if (multilingual){
                        if (search_area > 1){
                            search_url = search_url + " title_les2eu:" + word_list[index];
                        }
                        else {
                            search_url = search_url + " text_les2eu:" + word_list[index];
                        }
                    }
                }
                if (search_language == 0 || search_language == 2){
                    if (search_area > 1){
                        search_url = search_url + " title_les:" + word_list[index] + "^1.5";
                    }
                    else{
                        search_url = search_url + " text_les:" + word_list[index] + "^1.5";
                    }
                    if (multilingual){
                        if (search_area > 1){
                            search_url = search_url + " title_leu2es:" + word_list[index];
                        }
                        else{
                            search_url = search_url + " text_leu2es:" + word_list[index];
                        }
                    }
                }
            }
        }
        if (!corrected_query){
            search_url = search_url + "&spellcheck=true";
            if (search_language == 0 || search_language == 1){
                search_url = search_url + "&spellcheck.dictionary=spell_eu&spellcheck.dictionary=wordbreak_eu";
            }
            if (search_language == 0 || search_language == 2){
                search_url = search_url + "&spellcheck.dictionary=spell_es&spellcheck.dictionary=wordbreak_es";
            }
        }
        search_url = search_url + "&hl=true&hl.fl=title_st description_st body_st";
        if (offset > 0){
            search_url = search_url + "&start=" + offset;
        }
        if (search_order > 1){
            search_url = search_url + "&sort=pub_date desc";
        }
        search_url = search_url + "&rows=" + rows + "&wt=xml";
        xmlHttp.open("GET",search_url,true);
        xmlHttp.onreadystatechange = function (){
            make_search_answer(xmlHttp,search_text,search_language,multilingual,search_area,search_order,offset,corrected_query);
        };
        xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xmlHttp.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xmlHttp.send();
    }
}

//make search answer
function make_search_answer(xmlHttp,search_text,search_language,multilingual,search_area,search_order,offset,corrected_query){
    if (xmlHttp.readyState == 4){
        if(xmlHttp.status == 200){
            xml_answer = xmlHttp.responseXML;
            xml_Document = xml_answer.documentElement;
            var answer_docs = xml_Document.getElementsByTagName("result")[0];
            var highlighting = answer_docs.nextElementSibling;
            var collation_hits = 0;
            var to_correct = false;
            if ((!corrected_query) && (highlighting.nextElementSibling)){
                var suggestions = highlighting.nextElementSibling.firstChild;
                if (suggestions.children.length > 0){
                    var collation = suggestions.lastElementChild;
                    if (collation.getAttribute("name") == "collation"){
                        collation_hits = collation.children[1].firstChild.data;
                    }
                }
            }
            if ((!corrected_query) && (collation_hits > 0) && (collation_hits >= answer_docs.children.length)){
                var corrections = collation.lastElementChild.children;
                var candidates = new Array();
                var textFrom = "";
                for (var index=0;index<corrections.length;index++){
                    textFrom = corrections[index].getAttribute("name");
                    if (!candidates[textFrom]){
                        candidates[textFrom] = corrections[index].firstChild.data;
                    }
                    if (textFrom == corrections[index].firstChild.data){
                        candidates[textFrom] = corrections[index].firstChild.data;
                    }
                }
                for(var candidate in candidates) {
                    if (candidates.hasOwnProperty(candidate)) {
                        to_correct = to_correct || (candidates[candidate] != candidate);
                    }
                }
                if (to_correct){
                    var doc_list = document.getElementById("search_results");
                    var did_you_mean = search_text;
                    for(var candidate in candidates) {
                        if (candidates.hasOwnProperty(candidate)) {
                            did_you_mean = did_you_mean.replace(new RegExp(candidate, "i"),candidates[candidate]);
                        }
                    }
                    var span_dym = document.createElement("div");
                    span_dym.setAttribute("class","alert alert-warning");
                    span_dym.appendChild(document.createTextNode(did_you_mean + " bilatu nahi zenuen?"));
                    doc_list.appendChild(span_dym);
                    var collation = suggestions.children[index];
                    make_search_request(did_you_mean,search_language,multilingual,search_area,search_order,offset,true);
                }
            }
            if (!to_correct){
                if ((answer_docs.children.length > 0) && (collation_hits <= answer_docs.children.length)){
                    var answers_found = answer_docs.getAttribute("numFound");
                    var offset_s = document.getElementById("offset");
                    if (offset_s.options.length == 0){
                        var h_search_box = document.getElementById("h_search_box");
                        var h_search_language = document.getElementById("h_search_language");
                        var h_multilingual = document.getElementById("h_multilingual");
                        var h_search_area = document.getElementById("h_search_area");
                        var h_search_order = document.getElementById("h_search_order");
                        h_search_box.value = search_text;
                        h_search_language.value = search_language;
                        h_multilingual.value = multilingual;
                        h_search_area.value = search_area;
                        h_search_order.value = search_order;
                        var offset_s = document.getElementById("offset");
                        for (var index=0;index<Math.ceil(answers_found/rows);index++){
                            var option = document.createElement("option");
                            option.appendChild(document.createTextNode(index+1))
                            offset_s.appendChild(option);
                        }
                        if (offset_s.options.length > 1){
                            offset_s.removeAttribute("disabled");
                        }
                    }
                    for (var index=0;index<Math.min(rows, answer_docs.children.length);index++){
                        create_answer(answer_docs.children[index],highlighting.children[index]);
                    }
        			stop_loader();
                }
                else if (answer_docs.children.length == 0){
				    show_bs_message("empty_answer_error"); 
        			stop_loader();
                }
            }
        }
    }
}

//create answer
function create_answer(doc_element,highlight_element){
    var pub_date = "";
    var article_id = "";
    var article_language = "";
    var image_url = "";
    var description = "";
    var title = "";
    var body = "";
    for (index=0;index<doc_element.children.length;index++){
        switch (doc_element.children[index].getAttribute("name")){
            case "id":
                article_id = doc_element.children[index].firstChild.data;
                break;
            case "language":
                article_language = doc_element.children[index].firstChild.data;
                break;
            case "title_st":
                title = doc_element.children[index].firstChild.data;
                break;
            case "description_st":
                description = doc_element.children[index].firstChild.data;
                break;
            case "pub_date":
                pub_date = new Date(doc_element.children[index].firstChild.data).toISOString().slice(0, 10);
                break;
            case "image_url":
                if (doc_element.children[index].firstChild){
                    image_url = doc_element.children[index].firstChild.data;
                }
                else{
                    image_url = "";
                }
                break;
        }
    }
    if (highlight_element){
        for (index=0;index<highlight_element.children.length;index++){
            switch (highlight_element.children[index].getAttribute("name")){
                case "title_st":
                    title = highlight_element.children[index].children[0].firstChild.data;
                    break;
                case "description_st":
                    description = highlight_element.children[index].children[0].firstChild.data;
                    break;
                case "body_st":
                    body = highlight_element.children[index].children[0].firstChild.data;
                    break;
            }
        }
    }

    var div_doc = document.createElement("div");
    div_doc.setAttribute("class","row clearfix");

    var doc_url = document.createElement("a");
    doc_url.setAttribute("class","doc_title");
    doc_url.setAttribute("target","_blank");
    doc_url.setAttribute("href","article_detail.html?id=" + article_id + "&lang=" + article_language);

    var doc_title = document.createElement("h3");
    doc_title.innerHTML = title;
    doc_url.appendChild(doc_title);

    div_doc.appendChild(doc_url);

    if (image_url != ""){
        var doc_img = document.createElement("img");
        doc_img.setAttribute("class","doc_image");
        doc_img.setAttribute("src",image_url);
        div_doc.appendChild(doc_img);
    }
    
    var doc_date = document.createElement("small");
    doc_date.appendChild(document.createTextNode(pub_date));
    div_doc.appendChild(doc_date);

    var doc_desc = document.createElement("h4");
    doc_desc.setAttribute("class","doc_description");
    doc_desc.innerHTML = description;
    div_doc.appendChild(doc_desc);

    var doc_body = document.createElement("p");
    doc_body.innerHTML = body;
    div_doc.appendChild(doc_body);

    var doc_list = document.getElementById("search_results");
    doc_list.appendChild(div_doc);
}
	
	
</script>




<script type="text/javascript">   

//AUTOPLAY
function Redirect(url) 
{  
	window.location=url; 
} 
//document.write("You will be redirected to a new page in 5 seconds"); 
//setTimeout('Redirect()', 5000);   

function doSetTimeOutAutoplay(url,sec)
{
	//alert("doSetTimeOutAutoplay");
	//alert(url);
	//setTimeout('Redirect('+url+')', sec);
	setTimeout(function(){window.location = url;}, sec);
}

</script>

</head>





{% if user.is_authenticated %}
<body style="padding-top:0px;" onload="initialize();">
	<!--<body onload="setTimeout(function(){window.location = 'itemak_hasiera';}, 5000)">-->
	
	<!-- WORKSPACE -->
	<div id="workspace">
       	<div id="workspace_boxes" ondrop="ws_drop(event)" ondragover="allowDrop(event)">
       		<a type="button" class="btn btn-default btn-xs pathBotoia" href="{{BASE_URL}}/sortu_ibilbidea">{% trans "sortu ibilbidea" %}
       		<span class="glyphicon glyphicon-edit" aria-hidden="true"> 
       		</span> 
      	 	</a>
       	</div>
       	<button type="button" class="btn btn-default btn-xs" onclick="toggle_workspace();">
       		<span class="glyphicon glyphicon-pencil" aria-hidden="true"> 
       		</span> 
       		{% trans "Lan eremua" %}    		
       	</button>
       	
    </div>
 
    <!-- END WORKSPACE -->
 {%else%}
 <body style="padding-top:0px;"><!--goiko margina -->
 {% endif %} 
    
	<!-- PAGE -->
	<div  style="max-width:1210px;margin:0 auto;"><!--aldeetako margina -->
			
	
		<!-- LOGINA  ZAHARRA-->
<!--		
		<div class="erabiltzaile-menua" >
			{% if user.is_authenticated %}
			
			<div class="dropdown">
  				
 				 <a href="#" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">{{request.user.username}} <b class="caret"></b></a>
        
				<ul class="dropdown-menu">
    				<li><a href="nire_itemak_erakutsi">{% trans "Nire itemak" %}</a></li>
    				<li><a href="nire_ibilbideak_erakutsi">{% trans "Nire ibilbideak" %}</a></li>
    				<li><a href="itema_gehitu">{% trans "Item berria gehitu" %} <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
       				</li></a>
      				
    				<li role="separator" class="divider"></li>
				    <li><a href="perfila_erakutsi">{% trans "Profila" %}</a></li>
				    <li><a href="pasahitza_aldatu">{% trans "Pasahitza Aldatu" %}</a></li>
				    <li role="separator" class="divider"></li>
				    <li><a href="irten">{% trans "Irten" %} <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span></a>
						
					</li>
  				</ul>
			</div>

			<a href="irten">{% trans "Irten" %}</a>
			<span class="glyphicon glyphicon-log-out" aria-hidden="true"> 
			</span>
			{% else %}
			<a href="erregistratu">{% trans "Erregistratu" %} </a>
			|
			<a href="logina">{% trans "Login" %} </a>
			<span class="glyphicon glyphicon-log-in" aria-hidden="true"> 
    	   	</span>
    	   	{% endif %}
		</div>
		
-->
		
	<!-- END LOGINA  ZAHARRA-->
	
	<!-- HEADER  ZAHARRA-->
		<!--
	<div class="page-header headerra">
		<a title="KulturBideak" href="http://www.kulturbideak.org/search">
 			<h1>K<small>ultur</small>B<small>ideak</small></h1>			
		</a>	
		<div class="input-group">
		<form action="/search" method="get" class="form">
		{% csrf_token %}
		
			{% trans "Bilatu ..." as the_placeholder %}
      		<input id="id_q" class="form-control" type="search" title="" placeholder="{{ the_placeholder }}" name="q">
     		<span class="input-group-btn">
       			<button class="btn btn-default" type="submit">
       			   <span class="glyphicon glyphicon-search" aria-hidden="true"></span>	!
       			 </button>
       			
       			
      		</span>
      		
      		
      	</form>
      	
   	</div>
	</div>
	-->
	<!-- BUKATU HEADER  ZAHARRA-->
	
	<!-- HIZKUNTZAK-->
	<!--
    <div class="header-content">
		
		<div class="hizkuntzak_class" >
			
		
			<form id="hizkuntza_aukeraketa_id" name="setLang{{ lang.1 }}" action="/i18n/setlang/" method="post">{% csrf_token %}
                <input name="next" type="hidden" value="#" />
                <input type="hidden" name="language" value="{{ lang.0 }}" />
                {% get_current_language as LANGUAGE_CODE %}
                <ul class="ulhizkuntzak">
                {% for langa in LANGUAGES %}
                    {% if forloop.last %}
                        {% if langa.1 ==  LANGUAGE_CODE %}
                           <li><a class="active" href="#" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a></li>
                        {% else %}
                            <li><a href="#" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a></li>
                        {% endif %}                    
                    {% else %}
                        {% if langa.1 == LANGUAGE_CODE %}
                            <li><a href="#" class="active" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a></li>
                        {% else %}
                           <li> <a href="#" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a></li>
                        {% endif %}                
                    {% endif %}
                {% endfor %}
                </ul>
            </form>  
		</div>
	</div>
	-->
	
	<!--HEADER PROBA -->
	
	
    
    <nav class="navbar navbar-default navbar-default-berria" role="navigation">
 	 <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  
			
		
			<form id="hizkuntza_aukeraketa_id" name="setLang{{ lang.1 }}" action="/i18n/setlang/" method="post">{% csrf_token %}
                <input name="next" type="hidden" value="#" />
                <input type="hidden" name="language" value="{{ lang.0 }}" />
                {% get_current_language as LANGUAGE_CODE %}
                <p>
                
                {% for langa in LANGUAGES %}
                    {% if forloop.last %}
                        {% if langa.1 ==  LANGUAGE_CODE %}
                           <a class="active" href="#" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a>
                        {% else %}
                            <a href="#" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a>
                        {% endif %}                    
                    {% else %}
                        {% if langa.1 == LANGUAGE_CODE %}
                            <a href="#" class="active" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a>
                        {% else %}
                          <a href="#" onclick="hizkuntza_url_egokitu(this);">{{ langa.1 }}</a>
                        {% endif %}                
                    {% endif %}
                {% endfor %}
               </p>
               <p>
    			<a class="navbar-brand navbar-brand-berria" title="kulturbideak" href="{{BASE_URL}}">
 					<span class="laguntza">O<small>ndare</small></span>B<small>ideak</small>			
				</a>
				</p>
                
            </form>  
		
		
	
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">
      <li><a href="{{BASE_URL}}/itemak_hasiera">
         ITEMAK
         </a>
      </li>
      <li>
      	<a href="{{BASE_URL}}/ibilbideak_hasiera">
      		IBILBIDEAK
      	</a>
      </li>
    </ul>
  
    <div class="col-sm-3 col-md-3 bilatzailea-kutxa">
		<!--<form action="/search" method="get" class="navbar-form">-->
		<form action="{{BASE_URL}}/cross_search" method="post" class="navbar-form autocomplete-me">
			
		{% csrf_token %}
			<div class="input-group">
			{% trans "Bilatu ..." as the_placeholder %}
			<!-- id=id_q-->
      		<input id="search_input" class="form-control" type="search" title="" placeholder="{{ the_placeholder }}" name="search_input">
     		<span class="input-group-btn">
       		<button class="btn btn-default" type="submit">
       			   <span class="glyphicon glyphicon-search" aria-hidden="true"></span>	!
       		</button>   
       		
      		</span>
      		
      	</div>
      		<input  type="radio" name="hizkRadio" value="eu" checked> Eu
			<input  type="radio" name="hizkRadio" value="es"> Es
			<input  type="radio" name="hizkRadio" value="en"> En
      	</form>
      	
   	</div><!-- /input-group -->	
   	
   	
   	<!-- PROBA HASI -->  	


   

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript">
    // In a perfect world, this would be its own library file that got included
    // on the page and only the ``$(document).ready(...)`` below would be present.
    // But this is an example.
    var Autocomplete = function(options) {
      this.form_selector = options.form_selector
      this.url = options.url || '/autocomplete/'
      this.delay = parseInt(options.delay || 300)
      this.minimum_length = parseInt(options.minimum_length || 3)
      this.form_elem = null
      this.query_box = null
    }

    Autocomplete.prototype.setup = function() {
      var self = this

      this.form_elem = $(this.form_selector)
      this.query_box = this.form_elem.find('input[name=search_input]')

      // Watch the input box.
      this.query_box.on('keyup', function() {
        var query = self.query_box.val()

        if(query.length < self.minimum_length) {
          return false
        }

        self.fetch(query)
      })

      // On selecting a result, populate the search field.
      this.form_elem.on('click', '.ac-result', function(ev) {
        self.query_box.val($(this).text())
        $('.ac-results').remove()
        return false
      })
    }

    Autocomplete.prototype.fetch = function(query) {
      var self = this

      $.ajax({
        url: this.url
      , data: {
          'q': query
        }
      , success: function(data) {
          self.show_results(data)
          
        }
      })
    }

    Autocomplete.prototype.show_results = function(data) {
      // Remove any existing results.
      $('.ac-results').remove()

      var results = data.results || []
      var results_wrapper = $('<div class="ac-results"></div>')
      var base_elem = $('<div class="result-wrapper"><a href="#" class="ac-result"></a></div>')

      if(results.length > 0) {
        for(var res_offset in results) {
          var elem = base_elem.clone()
          // Don't use .html(...) here, as you open yourself to XSS.
          // Really, you should use some form of templating.
          elem.find('.ac-result').text(results[res_offset])
          results_wrapper.append(elem)
        }
      }
      else {
        var elem = base_elem.clone()
        elem.text("No results found.")
        results_wrapper.append(elem)
      }

      this.query_box.after(results_wrapper)
    }

    $(document).ready(function() {
      window.autocomplete = new Autocomplete({
        form_selector: '.autocomplete-me'
      })
      window.autocomplete.setup()
    })
  </script> 	
   	
   	
   	
   	
   	<!-- BIGARREN PROBA-->
    {% if user.is_authenticated %}
    <ul class="nav navbar-nav navbar-right">
      <li><a href="{{BASE_URL}}/irten"> <span class="glyphicon glyphicon-log-out" aria-hidden="true"> 
	 </span> {% trans "Irten" %}</a></li>
     <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> {{request.user.username}} <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href="nire_itemak_erakutsi">{% trans "Nire itemak" %}</a></li>
    				<li><a href="{{BASE_URL}}/nire_ibilbideak_erakutsi">{% trans "Nire ibilbideak" %}</a></li>
    				<li role="separator" class="divider"></li>
    				<li><a href="{{BASE_URL}}/oaipmh_datubilketa">{% trans "OAI-PMH bidezko itemen bilketa" %}</a></li>
    				<li><a href="{{BASE_URL}}/itema_gehitu">{% trans "Item berria gehitu" %} <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
       				</li></a>
      				
    				<li role="separator" class="divider"></li>
				    <li><a href="{{BASE_URL}}/perfila_erakutsi">{% trans "Profila" %}</a></li>
				    <li><a href="{{BASE_URL}}/pasahitza_aldatu">{% trans "Pasahitza Aldatu" %}</a></li>
				    <li role="separator" class="divider"></li>
				    <li><a href="{{BASE_URL}}/irten">{% trans "Irten" %} 
				    	<!--<span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>--></a>
						
					</li>
        </ul>
      </li>
    </ul>
    {% else %}
     <ul class="nav navbar-nav navbar-right">
			<li><a href="{{BASE_URL}}/erregistratu">{% trans "Erregistratu" %} </a></li>
			
			<li><a href="{{BASE_URL}}/logina"><span class="glyphicon glyphicon-log-in" aria-hidden="true"> 
    	   	</span> {% trans "Login" %} </a>
			</li>
     </ul>
    {% endif %}
    
    
  </div><!-- /.navbar-collapse -->
</nav>
    
    
    
<!-- BUKATU HEADER PROBA-->
<!--
	{% if user.is_authenticated %}
	<div class="erabiltzaile-menua" >
      	<a href="itema_gehitu">{% trans "Item berria gehitu" %} </a>
      	<span class="glyphicon glyphicon-upload" aria-hidden="true"> 
       	</span>
       	
       			
     </div>
	{% endif %}
	-->
		
	<!-- BILATZAILEA -->
	<!--	
	<div class="input-group">
		<form action="/search" method="get" class="form">
		{% csrf_token %}
		
			{% trans "Bilatu ..." as the_placeholder %}
      		<input id="id_q" class="form-control" type="search" title="" placeholder="{{ the_placeholder }}" name="q">
     		<span class="input-group-btn">
       			<button class="btn btn-default" type="submit">
       			   <span class="glyphicon glyphicon-search" aria-hidden="true"></span>	!
       			 </button>
       			
       			
      		</span>
      		
      		
      	</form>
      	
   	</div>
	-->	
	<!-- END BILATZAILEA -->
		
	<hr>	
	<!--PANTAILA EGITURA NAGUSIA-->
	<div class="orria">
	 	<div class="eskuma_div" align="right" >
	 		<b>{% trans "Hornitzaileak" %} </b>
	 		<br />
	 		<br />
	 		<p>EuskoMedia</p>
	 		

	 	</div>	
			
		<div class="content_div" align="center">
			{% if mezua %}
				
				<div class="alert alert-info" role="alert"><strong>Ondo!</strong> {{mezua}}</div>

			{%endif%}
			{% if errore_mezua %}
			
				<div class="alert alert-danger" role="alert">
 					<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
 					<span class="sr-only">Error:</span>
 					<strong>Kontuz!</strong> {{errore_mezua}}	
				</div>

			{%endif%}
			{% if nondik %}
			
			<div class="itema_gehitu">
				<div class="panel panel-info">
				<div class="panel-heading">
					<h1 class="panel-title">{{titulua}}</h1>
				</div>
			<div class="panel-body">
    
   	 		<div class="col-xs-6 col-md-3" align="center">
   			 <a href="#" class="thumbnail">
     		 <!--<img alt="Item has not thumbnail image" src="http://paths.sheffield.ac.uk/pathsui/europeana/static/img/no_img.png">-->
	 			 <img alt="{{titulua}}" src="{{irudia}}">
 			   </a>
 			</div>
 			<div class="item_edukia">
 			
 			<p><b>{% trans "Herrialdea:" %} </b><a href="">{{herrialdea}} </a></p>
 			<p><b>{% trans "Hizkuntza:" %}</b><a href="">{{hizkuntza}} </a></p>
 			<p><b>{% trans "Hornitzailea:" %}</b><a href="">{{hornitzailea}} </a></p>
 			<p><b>{% trans "Eskubideak: " %}</b><a href="">{{eskubideak}} </a></p>
 			<p><b>{% trans "Urtea:" %}</b><a href="">{{urtea}} </a></p>
 			
 			</div>
		
 		 	</div>
	
			</div>

			</div>
			{%endif%}
			
			{% block content %}
			
			
			{% endblock content %}
		</div>
		<div class="ezkerra_div" align="left">
			<div><b>{% trans "Azkenak" %} </b></div>
			
			<br />
			<br />
			{% if user.is_authenticated %}
			<!-- nire_ibilbideak javascript bidez kargatzen da. Initialize() -> load_paths_list(user_id)-->	
			<!--<div id="nire_ibilbideak"><b>{% trans "Nire Ibilbideak" %} </b></div>-->
			
			{% endif %}
			
			<div id="ibilbide_bozkatuenak"><b>{% trans "Ibilbide Bozkatuenak" %} </b></div>
			
			<br />
			<br />
			{% if user.is_authenticated %}
			<!-- nire_ibilbideak javascript bidez kargatzen da. Initialize() -> load_paths_list(user_id)-->	
			<!--<div id="nire_ibilbideak"><b>{% trans "Nire Ibilbideak" %} </b></div>-->
			
			{% endif %}
			
			<div class=""><b>{% trans "Eguneko Itema" %} </b>
				
				<div class="column">
				<br />
  					<div class="col-xs-6 col-md-12">
    					<a class="thumbnail" href="#">
						<img src="http://europeanastatic.eu/api/image?uri=http://www.peoplesnetwork.gov.uk/dpp/resource/2515311/stream/thumbnail_image_jpeg&size=FULL_DOC">
						</a>
  					</div>
				</div>
				
			</div>
			
			<!-- ITEMA AZALTZEN DE LEHEN 5 IBILBIDEAK ERAKUTSI. GAINONTZEKOAK MODAL BATEAN-->
			{%if itemPaths %}
			<div class=""><b>{% trans "Ze Ibilbidetan? " %} </b>
			{% for node in itemPaths %}
				{% if forloop.counter < 4 %}
					<p><a href="nabigazioa_hasi?path_id={{node.fk_path_id.id}}">{{node.fk_path_id.dc_title}} </a></p>
				{%endif%}
			{%endfor%}
			</br>
			{% if itemPaths|length  >= 1 %} <!-- ONDOREN >= 4 JARRI-->
			<a class="aRight" href="" data-toggle="modal" data-target="#modalMore"><span class="glyphicon glyphicon-plus">&nbsp;&nbsp;</span></a>
			{%endif%}
			
			</div>
			{%endif%}
			<br />
			<br />
			<div class="laguntza"><b>{% trans "Laguntza" %} </b>
				<p>In this area you will always find a brief help text for the current page.</p>
				
			</div>
		</div>
 	</div>	

</div> <!-- END PAGE -->
<hr>

	
	
	<div class="container marketing">
		<div class="well text-center">
			<div class="ssk-group ssk-round ssk-count">
				<a class="ssk ssk-facebook" href="">
				
				</a>
				<a class="ssk ssk-twitter" href="">
				
				</a>
				<a class="ssk ssk-google-plus" href="">
				
				</a>
				<a class="ssk ssk-email" href=""></a>
				
			</div>
			
		</div>
		<!--{% qr_from_mail "m.lopezdelacalle@elhuyar.com" "s" %}-->
	</div>



<!--Ventana modal-->

<div class="modal fade" id="modalMore" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">         
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4>Itema ondorengo ibilbideetan bisita dezakezu</h4>
            </div>
            <div class="modal-body">
                <div class="row">               
                    <div class="panel-body">
                    	
                    		<div id="messages"></div>                                                       
                            {% for node in itemPaths %}							
								<label for="exampleInputEmail1"><a href="nabigazioa_hasi?path_id={{node.fk_path_id.id}}">{{node.fk_path_id.dc_title}} </a></label><br/>				
							{%endfor%}                      
                            <br/>						
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Atera</button>                                
                            </div>                            
                            <p><br/></p>                    
                    </div>                       
                </div>
            </div>
            
        </div>
    </div>
</div>

 

<!--Fin Ventana modal-->







<!-- Latest compiled and minified JavaScript -->
<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>-->
<script type="text/javascript">
SocialShareKit.init();
</script>

</body>
</html>

